import{r as u,s as g,j as i,Y as y}from"./index-BiNiRHKa.js";import{S as j,a as V,b,c as C,d as S}from"./select-QQKt8PR4.js";import{d as x}from"./demoStore-BIsfGJR8.js";function f(e){const l=(e==null?void 0:e.placa)||(e==null?void 0:e.plate)||"",m=(e==null?void 0:e.modelo)||(e==null?void 0:e.model)||"",o=(e==null?void 0:e.tipo)||(e==null?void 0:e.type)||"",n=(e==null?void 0:e.status)||"",c=(e==null?void 0:e.km)||(e==null?void 0:e.mileage)||(e==null?void 0:e.odometer)||void 0;return{plate:l,model:m,type:o,status:n,mileage:c}}function E(){const[e,l]=u.useState([]),[m,o]=u.useState(!0),[n,c]=u.useState(""),r=async()=>{o(!0),c("");try{const{data:t,error:a}=await g.from("vehicles").select("*");if(a)throw a;let s=(t||[]).map(f).filter(p=>!!p.plate).sort((p,d)=>p.plate.localeCompare(d.plate));if(s.length===0){const d=(x("vehicles")||[]).map(f);d.length>0?s=d:s=[{plate:"EJG-1234",model:"Demo",type:"Caminhão",status:"Ativo"}]}l(s)}catch(t){const s=(x("vehicles")||[]).map(f);l(s.length?s:[{plate:"EJG-1234",model:"Demo",type:"Caminhão",status:"Ativo"}]),c((t==null?void 0:t.message)||"Falha ao carregar veículos")}finally{o(!1)}};return u.useEffect(()=>{r();const t=g.channel("vehicles_changes").on("postgres_changes",{event:"*",schema:"public",table:"vehicles"},()=>r()).subscribe();return()=>{g.removeChannel(t)}},[]),{vehicles:e,loading:m,error:n,refresh:r,getByPlate:t=>e.find(a=>a.plate===t)}}function B({value:e,onChange:l,className:m,placeholder:o="Selecione uma placa",filter:n,required:c}){const{vehicles:r,loading:h}=E(),t=n?r.filter(n):r;return i.jsxs(j,{value:e||"",onValueChange:l,required:c,children:[i.jsx(V,{className:y("w-full",m),children:i.jsx(b,{placeholder:h?"Carregando...":o})}),i.jsxs(C,{children:[t.map(a=>i.jsxs(S,{value:a.plate,children:[a.plate," ",a.model?`- ${a.model}`:""]},a.plate)),t.length===0&&!h&&i.jsx(S,{value:"_empty",disabled:!0,children:"Nenhum veículo encontrado"})]})]})}export{B as V,E as u};
