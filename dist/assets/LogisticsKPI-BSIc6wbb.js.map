{"version":3,"file":"LogisticsKPI-BSIc6wbb.js","sources":["../../src/utils/kpis.ts","../../src/pages/LogisticsKPI.tsx"],"sourcesContent":["export function costPerKm(totalFixed: number, totalVariable: number, totalKm: number) {\n  if (totalKm <= 0) return 0;\n  return (totalFixed + totalVariable) / totalKm;\n}\n\nexport function avgFuelKmPerLiter(totalKm: number, totalLiters: number) {\n  if (totalLiters <= 0) return 0;\n  return totalKm / totalLiters;\n}\n\nexport function unavailabilityIndex(daysInactive: number, daysTotal: number) {\n  if (daysTotal <= 0) return 0;\n  return (daysInactive / daysTotal) * 100;\n}\n\nexport function idleCost(dailyRevenueLost: number, daysStopped: number) {\n  return dailyRevenueLost * daysStopped;\n}\n\nexport function emptyMileagePercent(emptyKm: number, totalKm: number) {\n  if (totalKm <= 0) return 0;\n  return (emptyKm / totalKm) * 100;\n}\n\nexport function operationalSpeed(distanceKm: number, movingHours: number) {\n  if (movingHours <= 0) return 0;\n  return distanceKm / movingHours;\n}\n\n","import { Layout } from \"@/components/Layout\";\nimport { Card } from \"@/components/ui/card\";\nimport { supabase } from \"@/integrations/supabase/client\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { costPerKm, avgFuelKmPerLiter, emptyMileagePercent, operationalSpeed } from \"@/utils/kpis\";\n\nconst LogisticsKPI = () => {\n  const refuel = useQuery({\n    queryKey: [\"refuelings\"],\n    queryFn: async () => (await supabase.from(\"refuelings\" as any).select(\"km,liters,total_value,cost_per_km,timestamp\").order(\"timestamp\", { ascending: false })).data as any[] || [],\n  });\n  const deliveries = useQuery({\n    queryKey: [\"revenue_records\"],\n    queryFn: async () => (await supabase.from(\"revenue_records\" as any).select(\"data_emissao,valor_frete,peso_kg\").order(\"data_emissao\", { ascending: false })).data as any[] || [],\n  });\n  const sessions = useQuery({\n    queryKey: [\"driver_work_sessions\"],\n    queryFn: async () => (await supabase.from(\"driver_work_sessions\" as any).select(\"start_time,end_time,km_start,km_end\").order(\"start_time\", { ascending: false })).data as any[] || [],\n  });\n\n  const totalKm = (sessions.data||[]).reduce((s, w)=> s + Math.max(0,(w.km_end||0)-(w.km_start||0)), 0);\n  const totalLiters = (refuel.data||[]).reduce((s, r)=> s + (r.liters||0), 0);\n  const totalFuelCost = (refuel.data||[]).reduce((s, r)=> s + (r.total_value||0), 0);\n  const avgCpk = (refuel.data||[]).filter(r=>r.cost_per_km).reduce((s,r)=>s+(r.cost_per_km||0),0)/Math.max(1,(refuel.data||[]).filter(r=>r.cost_per_km).length);\n\n  const kmpl = avgFuelKmPerLiter(totalKm, totalLiters);\n  const cpk = avgCpk || costPerKm(0, totalFuelCost, totalKm);\n  const emptyPct = emptyMileagePercent(0, totalKm); // placeholder se não houver flag de vazio\n  const speed = operationalSpeed(totalKm, ((sessions.data||[]).reduce((s,w)=> s + Math.max(0,(new Date(w.end_time||w.start_time).getTime()-new Date(w.start_time).getTime())/(1000*60*60)),0)));\n\n  return (\n    <Layout>\n      <div className=\"space-y-6\">\n        <h1 className=\"text-2xl font-bold\">Indicadores Logísticos</h1>\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <Card className=\"p-4\"><div className=\"text-sm text-muted-foreground\">Custo por KM</div><div className=\"text-3xl font-bold\">R$ {cpk.toFixed(2)}</div></Card>\n          <Card className=\"p-4\"><div className=\"text-sm text-muted-foreground\">Consumo Médio (KM/L)</div><div className=\"text-3xl font-bold\">{kmpl.toFixed(2)}</div></Card>\n          <Card className=\"p-4\"><div className=\"text-sm text-muted-foreground\">Quilometragem em Vazio</div><div className=\"text-3xl font-bold\">{emptyPct.toFixed(1)}%</div></Card>\n          <Card className=\"p-4\"><div className=\"text-sm text-muted-foreground\">Velocidade Média</div><div className=\"text-3xl font-bold\">{speed.toFixed(1)} km/h</div></Card>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n          <Card className=\"p-4\"><div className=\"text-sm text-muted-foreground\">Entregas Recentes</div><div className=\"text-3xl font-bold\">{deliveries.data?.length || 0}</div></Card>\n          <Card className=\"p-4\"><div className=\"text-sm text-muted-foreground\">Abastecimentos</div><div className=\"text-3xl font-bold\">{refuel.data?.length || 0}</div></Card>\n        </div>\n      </div>\n    </Layout>\n  );\n};\n\nexport default LogisticsKPI;\n\n"],"names":["costPerKm","totalFixed","totalVariable","totalKm","avgFuelKmPerLiter","totalLiters","emptyMileagePercent","emptyKm","operationalSpeed","distanceKm","movingHours","LogisticsKPI","refuel","useQuery","queryKey","queryFn","supabase","from","select","order","ascending","data","deliveries","sessions","reduce","s","w","Math","max","km_end","km_start","r","liters","totalFuelCost","total_value","avgCpk","filter","cost_per_km","length","kmpl","cpk","emptyPct","speed","Date","end_time","start_time","getTime","Layout","jsxs","jsx","Card","toFixed"],"mappings":"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"}