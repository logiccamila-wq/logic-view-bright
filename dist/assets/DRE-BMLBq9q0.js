import{j as e,r as m,s as y,d as z}from"./index-BiNiRHKa.js";import{L as J,F as Z}from"./Layout-Dp_kOeVO.js";import{C as h,a as f,b as D,d as x}from"./card-TfuIT_5Q.js";import{L as B}from"./label-UYjdQhGu.js";import{S as T,a as F,b as U,c as k,d as g}from"./select-QQKt8PR4.js";import{R as ee,b as te,X as se,Y as re,T as ae,L as ie}from"./CartesianChart-hQJLzW7L.js";import{a as oe,L as I}from"./LineChart-D7XxyMx4.js";import{T as ne,a as ce,b as V,c as j,d as le,e as p}from"./table-BZVhxJnw.js";import{B as de,D as me}from"./badge-DNXvGi58.js";import{T as P}from"./trending-up-DqnRdfA9.js";import{T as pe}from"./trending-down-BJc73CKM.js";import"./index-DIpBNjZJ.js";import"./index-CwEJSXtc.js";import"./index-CDnZEIrr.js";import"./user-DUMs6VdZ.js";import"./check-CRXfG46A.js";import"./triangle-alert-DWEkvv_3.js";import"./circle-check-big-SjvrQ4v6.js";import"./warehouse-DuizGI0Y.js";import"./settings-ADCDQZ7C.js";import"./sparkles-Dn6_ZUdd.js";import"./input-CbZeJBr9.js";import"./tabs-D0EqSZrJ.js";import"./index-BjTUNxlL.js";import"./chevron-down-CMfBZ8DZ.js";import"./index-dbfCPaLo.js";import"./getRadiusAndStrokeWidthFromDot-CjiGgi48.js";function Ce({data:c}){const C=n=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(n);return e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(D,{children:"Evolução Financeira"})}),e.jsx(x,{children:e.jsx(ee,{width:"100%",height:300,children:e.jsxs(oe,{data:c,children:[e.jsx(te,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(se,{dataKey:"mes",className:"text-sm",tick:{fill:"hsl(var(--foreground))"}}),e.jsx(re,{tickFormatter:C,className:"text-sm",tick:{fill:"hsl(var(--foreground))"}}),e.jsx(ae,{formatter:n=>C(n),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}}),e.jsx(ie,{}),e.jsx(I,{type:"monotone",dataKey:"receitas",stroke:"hsl(var(--primary))",strokeWidth:2,name:"Receitas",dot:{fill:"hsl(var(--primary))"}}),e.jsx(I,{type:"monotone",dataKey:"despesas",stroke:"hsl(142, 76%, 36%)",strokeWidth:2,name:"Despesas",dot:{fill:"hsl(142, 76%, 36%)"}}),e.jsx(I,{type:"monotone",dataKey:"lucro",stroke:"hsl(221, 83%, 53%)",strokeWidth:2,name:"Lucro",dot:{fill:"hsl(221, 83%, 53%)"}})]})})})]})}function he({entries:c}){const C=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),n=a=>new Date(a).toLocaleDateString("pt-BR"),A=a=>a==="RECEITA"?"bg-green-500/20 text-green-600":"bg-red-500/20 text-red-600",R=c.reduce((a,o)=>(a[o.categoria]||(a[o.categoria]=[]),a[o.categoria].push(o),a),{});return e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(D,{children:"Detalhamento DRE"})}),e.jsx(x,{children:e.jsxs(ne,{children:[e.jsx(ce,{children:e.jsxs(V,{children:[e.jsx(j,{children:"Data"}),e.jsx(j,{children:"Categoria"}),e.jsx(j,{children:"Subcategoria"}),e.jsx(j,{children:"Descrição"}),e.jsx(j,{children:"Tipo"}),e.jsx(j,{className:"text-right",children:"Valor"})]})}),e.jsx(le,{children:Object.entries(R).map(([a,o])=>e.jsxs(e.Fragment,{children:[e.jsxs(V,{className:"bg-muted/50",children:[e.jsx(p,{colSpan:5,className:"font-bold",children:a}),e.jsx(p,{className:"text-right font-bold",children:C(o.reduce((i,l)=>i+(l.tipo==="RECEITA"?l.valor:-l.valor),0))})]},a),o.map(i=>e.jsxs(V,{children:[e.jsx(p,{className:"text-sm",children:n(i.data)}),e.jsx(p,{children:i.categoria}),e.jsx(p,{className:"text-sm text-muted-foreground",children:i.subcategoria||"-"}),e.jsx(p,{className:"text-sm",children:i.descricao||"-"}),e.jsx(p,{children:e.jsx(de,{className:A(i.tipo),children:i.tipo})}),e.jsxs(p,{className:"text-right font-medium",children:[i.tipo==="RECEITA"?"+":"-",C(i.valor)]})]},i.id))]}))})]})})]})}const qe=()=>{const[c,C]=m.useState([]),[n,A]=m.useState([]),[R,a]=m.useState([]),[o,i]=m.useState(!0),[l,q]=m.useState(new Date().getFullYear().toString()),[$,G]=m.useState("ano"),[w,H]=m.useState("todos");m.useEffect(()=>{W()},[l,$,w]);const W=async()=>{i(!0);try{const t=`${l}-01-01`,s=`${l}-12-31`,{data:r,error:E}=await y.from("dre_entries").select("*").gte("data",t).lte("data",s).order("data",{ascending:!1});if(E)throw E;let u=y.from("lancamentos_financeiros").select("*").gte("data",t).lte("data",s);w!=="todos"&&(u=u.eq("vehicle_placa",w));const{data:S,error:b}=await u;if(b)throw b;const{data:O,error:K}=await y.from("vehicles").select("*").in("status",["ativo","Ativo"]);K&&console.error("Erro ao carregar veículos:",K),C(r||[]),A(S||[]);const X=(O||[]).map(d=>({placa:d.placa||d.plate,modelo:d.modelo||d.model||""})).filter(d=>!!d.placa).sort((d,Q)=>d.placa.localeCompare(Q.placa));a(X)}catch(t){z.error(`Erro ao carregar DRE: ${t.message}`)}finally{i(!1)}},v=[...c.filter(t=>t.tipo==="RECEITA"),...n.filter(t=>t.tipo==="entrada")].reduce((t,s)=>t+s.valor,0),Y=[...c.filter(t=>t.tipo==="DESPESA"),...n.filter(t=>t.tipo==="saida")].reduce((t,s)=>t+s.valor,0),N=v-Y,_=v>0?N/v*100:0,L=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),M=()=>{const t={};return c.forEach(s=>{const r=new Date(s.data).toLocaleDateString("pt-BR",{month:"short",year:"2-digit"});t[r]||(t[r]={receitas:0,despesas:0}),s.tipo==="RECEITA"?t[r].receitas+=s.valor:t[r].despesas+=s.valor}),n.forEach(s=>{const r=new Date(s.data).toLocaleDateString("pt-BR",{month:"short",year:"2-digit"});t[r]||(t[r]={receitas:0,despesas:0}),s.tipo==="entrada"?t[r].receitas+=s.valor:t[r].despesas+=s.valor}),Object.entries(t).map(([s,r])=>({mes:s,receitas:r.receitas,despesas:r.despesas,lucro:r.receitas-r.despesas})).sort((s,r)=>{const[E,u]=s.mes.split(" "),[S,b]=r.mes.split(" ");return u===b?new Date(`${E} 1`).getTime()-new Date(`${S} 1`).getTime():Number(u)-Number(b)})};return e.jsx(J,{children:e.jsxs("div",{"trae-inspector-start-line":"158","trae-inspector-start-column":"6","trae-inspector-end-line":"268","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-6",children:[e.jsx("div",{"trae-inspector-start-line":"159","trae-inspector-start-column":"8","trae-inspector-end-line":"161","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-between",children:e.jsx("h1",{"trae-inspector-start-line":"160","trae-inspector-start-column":"10","trae-inspector-end-line":"160","trae-inspector-end-column":"83","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22DRE%20-%20Demonstrativo%20de%20Resultados%22%2C%22textStartLine%22%3A%22160%22%2C%22textStartColumn%22%3A%2245%22%2C%22textEndLine%22%3A%22160%22%2C%22textEndColumn%22%3A%2278%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-3xl font-bold",children:"DRE - Demonstrativo de Resultados"})}),e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{"trae-inspector-start-line":"166","trae-inspector-start-column":"12","trae-inspector-end-line":"214","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-4",children:[e.jsx(Z,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{"trae-inspector-start-line":"168","trae-inspector-start-column":"14","trae-inspector-end-line":"213","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex-1 grid grid-cols-3 gap-4",children:[e.jsxs("div",{"trae-inspector-start-line":"169","trae-inspector-start-column":"16","trae-inspector-end-line":"183","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(B,{htmlFor:"year",children:"Ano"}),e.jsxs(T,{value:l,onValueChange:q,children:[e.jsx(F,{children:e.jsx(U,{placeholder:"Selecione o ano"})}),e.jsx(k,{children:[2023,2024,2025].map(t=>e.jsx(g,{value:t.toString(),children:t},t))})]})]}),e.jsxs("div",{"trae-inspector-start-line":"184","trae-inspector-start-column":"16","trae-inspector-end-line":"196","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(B,{htmlFor:"period",children:"Período"}),e.jsxs(T,{value:$,onValueChange:G,children:[e.jsx(F,{children:e.jsx(U,{placeholder:"Selecione o período"})}),e.jsxs(k,{children:[e.jsx(g,{value:"mes",children:"Mensal"}),e.jsx(g,{value:"trimestre",children:"Trimestral"}),e.jsx(g,{value:"ano",children:"Anual"})]})]})]}),e.jsxs("div",{"trae-inspector-start-line":"197","trae-inspector-start-column":"16","trae-inspector-end-line":"212","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(B,{htmlFor:"vehicle",children:"Veículo"}),e.jsxs(T,{value:w,onValueChange:H,children:[e.jsx(F,{children:e.jsx(U,{placeholder:"Todos os veículos"})}),e.jsxs(k,{children:[e.jsx(g,{value:"todos",children:"Todos os veículos"}),R.map(t=>e.jsxs(g,{value:t.placa,children:[t.placa," - ",t.modelo]},t.placa))]})]})]})]})]})})}),e.jsxs("div",{"trae-inspector-start-line":"219","trae-inspector-start-column":"8","trae-inspector-end-line":"261","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Receitas"}),e.jsx(P,{className:"h-4 w-4 text-green-500"})]}),e.jsx(x,{children:e.jsx("div",{"trae-inspector-start-line":"226","trae-inspector-start-column":"14","trae-inspector-end-line":"226","trae-inspector-end-column":"102","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold text-green-500",children:L(v)})})]}),e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Despesas"}),e.jsx(pe,{className:"h-4 w-4 text-red-500"})]}),e.jsx(x,{children:e.jsx("div",{"trae-inspector-start-line":"236","trae-inspector-start-column":"14","trae-inspector-end-line":"236","trae-inspector-end-column":"100","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold text-red-500",children:L(Y)})})]}),e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Lucro Líquido"}),e.jsx(me,{className:"h-4 w-4"})]}),e.jsx(x,{children:e.jsx("div",{"trae-inspector-start-line":"246","trae-inspector-start-column":"14","trae-inspector-end-line":"248","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:`text-2xl font-bold ${N>=0?"text-green-500":"text-red-500"}`,children:L(N)})})]}),e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Margem de Lucro"}),e.jsx(P,{className:"h-4 w-4"})]}),e.jsx(x,{children:e.jsxs("div",{"trae-inspector-start-line":"258","trae-inspector-start-column":"14","trae-inspector-end-line":"258","trae-inspector-end-column":"81","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold",children:[_.toFixed(1),"%"]})})]})]}),!o&&e.jsx(Ce,{data:M()}),!o&&e.jsx(he,{entries:c})]})})};export{qe as default};
