{"version":3,"file":"Login-C0ZaGRVW.js","sources":["../../src/components/PWACacheReset.tsx","../../src/pages/Login.tsx"],"sourcesContent":["import { Button } from \"@/components/ui/button\";\n\nexport function PWACacheReset() {\n  const reset = async () => {\n    try {\n      if ('serviceWorker' in navigator) {\n        const regs = await navigator.serviceWorker.getRegistrations();\n        for (const r of regs) await r.unregister();\n      }\n      if ('caches' in window) {\n        const keys = await caches.keys();\n        await Promise.all(keys.map((k) => caches.delete(k)));\n      }\n    } finally {\n      window.location.reload();\n    }\n  };\n  return <Button variant=\"outline\" onClick={reset}>Atualizar App</Button>;\n}\n\n","import { useState, useEffect } from \"react\";\r\nimport { Button } from \"@/components/ui/button\";\r\nimport { Input } from \"@/components/ui/input\";\r\nimport { Label } from \"@/components/ui/label\";\r\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\r\nimport { Lock, Zap } from \"lucide-react\";\r\nimport { useNavigate, useLocation } from \"react-router-dom\";\r\nimport { useAuth } from \"@/contexts/AuthContext\";\r\nimport { supabase } from \"@/integrations/supabase/client\";\r\nimport { toast } from \"sonner\";\r\nimport { PWACacheReset } from \"@/components/PWACacheReset\";\r\n\r\nconst Login = () => {\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const { signIn, user, roles, loading: authLoading } = useAuth();\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [loading, setLoading] = useState(false);\r\n  const [resetMode, setResetMode] = useState(false);\r\n  const [resetSent, setResetSent] = useState(false);\r\n\r\n  // Redirecionar usuário autenticado conforme o papel\r\n  useEffect(() => {\r\n    if (!user || authLoading) return;\r\n\r\n    const onlyMechanic = roles.length > 0 && roles.every((r) =>\r\n      r === \"fleet_maintenance\" || r === \"maintenance_assistant\"\r\n    );\r\n\r\n    const onlyDriver = roles.length === 1 && roles[0] === \"driver\";\r\n\r\n    if (onlyMechanic) {\r\n      navigate(\"/mechanic\");\r\n    } else if (onlyDriver) {\r\n      navigate(\"/driver\");\r\n    } else {\r\n      navigate(\"/dashboard\");\r\n    }\r\n  }, [user, roles, authLoading, navigate]);\r\n\r\n  const handleLogin = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    \r\n    // Validação obrigatória\r\n    if (!email.trim()) {\r\n      toast.error('Por favor, informe o email');\r\n      return;\r\n    }\r\n    \r\n    if (!password) {\r\n      toast.error('Por favor, informe a senha');\r\n      return;\r\n    }\r\n\r\n    if (password.length < 6) {\r\n      toast.error('A senha deve ter no mínimo 6 caracteres');\r\n      return;\r\n    }\r\n    \r\n    setLoading(true);\r\n    \r\n    try {\r\n      await signIn(email.trim(), password);\r\n    } catch (error) {\r\n      // Error is handled in signIn function\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleResetPassword = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    \r\n    try {\r\n      const { error } = await supabase.auth.resetPasswordForEmail(email, {\r\n        redirectTo: `${window.location.origin}/reset-password`,\r\n      });\r\n      \r\n      if (error) throw error;\r\n      \r\n      setResetSent(true);\r\n      toast.success(\"Email enviado! Verifique sua caixa de entrada.\");\r\n    } catch (error: any) {\r\n      toast.error(error.message || \"Erro ao enviar email de redefinição\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const params = new URLSearchParams(location.search);\r\n  const brand = (params.get('brand') || '').toLowerCase();\r\n  const isAlb = brand === 'albuquerque';\r\n  const brandName = isAlb ? 'Albuquerque' : 'XYZLogicFlow';\r\n  const brandSubtitle = isAlb ? 'Acesse sua conta Albuquerque' : 'Acesse sua conta XYZLogicFlow';\r\n  const brandBg = isAlb ? '#2b2d31' : undefined;\r\n  \r\n  const BrandLogo = () => {\r\n    if (isAlb) {\r\n      const logoParam = params.get('logo') || '';\r\n      const src = logoParam || 'https://trae-api-us.mchost.guru/api/ide/v1/text_to_image?prompt=' +\r\n        encodeURIComponent('SDXL render of a metallic white monogram letter A with molecule nodes motif, centered above ALBUQUERQUE text and QUIMICA subtitle, embossed 3D on dark graphite background, cinematic studio lighting, ultra-detailed, logo mark minimal, no extra text beyond brand') +\r\n        '&image_size=square_hd';\r\n      return <img src={src} alt={brandName} className=\"h-16 w-auto\" />;\r\n    }\r\n    \r\n    return (\r\n      <div className=\"flex flex-col items-center gap-2\">\r\n        <div className=\"bg-white/20 p-3 rounded-xl backdrop-blur-md\">\r\n          <Zap className=\"h-10 w-10 text-white\" />\r\n        </div>\r\n        <span className=\"text-white font-bold text-xl tracking-tight\">XYZLogicFlow</span>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className={`min-h-screen flex items-center justify-center p-4 ${!isAlb ? 'bg-gradient-to-br from-indigo-700 via-blue-600 to-cyan-600' : ''}`} style={isAlb ? { backgroundColor: brandBg } : undefined}>\r\n      <Card className=\"w-full max-w-md border border-white/20 bg-white/10 backdrop-blur-xl shadow-2xl\">\r\n        <CardHeader className=\"text-center space-y-4\">\r\n          <div className=\"flex items-center justify-center mb-4\">\r\n            <BrandLogo />\r\n          </div>\r\n          <CardTitle className=\"text-2xl text-white\">\r\n            {resetMode ? \"Redefinir Senha\" : \"Entrar\"}\r\n          </CardTitle>\r\n          <CardDescription className=\"text-white/80\">\r\n            {resetMode ? \"Digite seu e-mail para receber as instruções\" : brandSubtitle}\r\n          </CardDescription>\r\n        </CardHeader>\r\n        <CardContent>\r\n          {resetSent ? (\r\n            <div className=\"text-center space-y-4\">\r\n              <p className=\"text-sm text-white/80\">\r\n                Um e-mail com as instruções foi enviado para <strong>{email}</strong>\r\n              </p>\r\n              <Button\r\n                variant=\"outline\"\r\n                className=\"w-full\"\r\n                onClick={() => {\r\n                  setResetSent(false);\r\n                  setResetMode(false);\r\n                }}\r\n              >\r\n                Voltar ao Login\r\n              </Button>\r\n            </div>\r\n          ) : (\r\n            <form onSubmit={resetMode ? handleResetPassword : handleLogin} className=\"space-y-4\">\r\n              <div className=\"space-y-2\">\r\n                <Label htmlFor=\"email\" className={!isAlb ? 'text-white' : ''}>E-mail *</Label>\r\n                <Input\r\n                  id=\"email\"\r\n                  type=\"email\"\r\n                  placeholder=\"seu@email.com\"\r\n                  value={email}\r\n                  onChange={(e) => setEmail(e.target.value)}\r\n                  required\r\n                  disabled={loading}\r\n                />\r\n              </div>\r\n              {!resetMode && (\r\n                <div className=\"space-y-2\">\r\n                  <Label htmlFor=\"password\" className={!isAlb ? 'text-white' : ''}>Senha *</Label>\r\n                  <Input\r\n                    id=\"password\"\r\n                    type=\"password\"\r\n                    placeholder=\"••••••••\"\r\n                    value={password}\r\n                    onChange={(e) => setPassword(e.target.value)}\r\n                    required\r\n                    minLength={6}\r\n                    disabled={loading}\r\n                  />\r\n                </div>\r\n              )}\r\n              <Button type=\"submit\" className=\"w-full\" size=\"lg\" disabled={loading} variant={isAlb ? undefined : 'modern'} style={isAlb ? { backgroundColor: '#bfc5cc', color: '#1f2326' } : undefined}>\r\n                {loading ? (resetMode ? \"Enviando...\" : \"Entrando...\") : (resetMode ? \"ENVIAR E-MAIL\" : \"ENTRAR\")}\r\n              </Button>\r\n              <Button\r\n                type=\"button\"\r\n                variant=\"ghost\"\r\n                className=\"w-full text-sm text-white/90\"\r\n                onClick={() => setResetMode(!resetMode)}\r\n                disabled={loading}\r\n              >\r\n                {resetMode ? \"Voltar ao Login\" : \"Esqueci minha senha\"}\r\n              </Button>\r\n              <p className=\"text-center text-xs text-white/80 flex items-center justify-center gap-2\">\r\n                <Lock className=\"w-3 h-3\" />\r\n                Seus dados estão protegidos por criptografia de ponta a ponta.\r\n              </p>\r\n          </form>\r\n          )}\r\n        </CardContent>\r\n      </Card>\r\n      <div className=\"mt-4\"><PWACacheReset /></div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Login;\r\n"],"names":["PWACacheReset","reset","navigator","regs","serviceWorker","getRegistrations","r","unregister","window","keys","caches","Promise","all","map","delete","k","location","reload","Button","Login","navigate","useNavigate","useLocation","signIn","user","roles","loading","authLoading","useAuth","email","setEmail","useState","password","setPassword","setLoading","resetMode","setResetMode","resetSent","setResetSent","useEffect","onlyMechanic","length","every","onlyDriver","handleLogin","e","preventDefault","trim","toast","error","handleResetPassword","supabase","auth","resetPasswordForEmail","redirectTo","origin","success","message","params","URLSearchParams","search","isAlb","get","toLowerCase","brandName","brandSubtitle","brandBg","undefined","BrandLogo","src","encodeURIComponent","jsxs","jsx","Zap","backgroundColor","Card","CardHeader","CardTitle","CardDescription","CardContent","Label","Input","target","value","color","Lock"],"mappings":"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"}