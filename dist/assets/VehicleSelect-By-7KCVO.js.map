{"version":3,"file":"VehicleSelect-By-7KCVO.js","sources":["../../src/lib/hooks/useVehicles.ts","../../src/components/VehicleSelect.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { demoList } from '@/lib/demoStore';\n\nexport type VehicleItem = {\n  plate: string;\n  model?: string;\n  type?: string;\n  status?: string;\n  mileage?: number;\n};\n\nfunction mapVehicle(v: any): VehicleItem {\n  const plate = v?.placa || v?.plate || '';\n  const model = v?.modelo || v?.model || '';\n  const type = v?.tipo || v?.type || '';\n  const status = v?.status || '';\n  const mileage = v?.km || v?.mileage || v?.odometer || undefined;\n  return { plate, model, type, status, mileage };\n}\n\nexport function useVehicles() {\n  const [vehicles, setVehicles] = useState<VehicleItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n\n  const load = async () => {\n    setLoading(true); setError('');\n    try {\n      const { data, error } = await supabase.from('vehicles').select('*');\n      if (error) throw error;\n      let mapped = (data || [])\n        .map(mapVehicle)\n        .filter(v => !!v.plate)\n        .sort((a, b) => a.plate.localeCompare(b.plate));\n\n      if (mapped.length === 0) {\n        // Fallback to demo data if DB is empty\n        const demo = demoList('vehicles') || [];\n        const demoMapped = demo.map(mapVehicle);\n        if (demoMapped.length > 0) {\n          mapped = demoMapped;\n        } else {\n           mapped = [{ plate: 'EJG-1234', model: 'Demo', type: 'Caminhão', status: 'Ativo' }];\n        }\n      }\n      \n      setVehicles(mapped);\n    } catch (e: any) {\n      const demo = demoList('vehicles') || [];\n      const mapped = demo.map(mapVehicle);\n      setVehicles(mapped.length ? mapped : [{ plate: 'EJG-1234', model: 'Demo', type: 'Caminhão', status: 'Ativo' }]);\n      setError(e?.message || 'Falha ao carregar veículos');\n    } finally { setLoading(false); }\n  };\n\n  useEffect(() => {\n    load();\n    const channel = supabase\n      .channel('vehicles_changes')\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'vehicles' }, () => load())\n      .subscribe();\n    return () => { supabase.removeChannel(channel); };\n  }, []);\n\n  const getByPlate = (plate: string) => vehicles.find(v => v.plate === plate);\n\n  return { vehicles, loading, error, refresh: load, getByPlate };\n}\n\n","import {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useVehicles, VehicleItem } from \"@/lib/hooks/useVehicles\";\nimport { cn } from \"@/lib/utils\";\n\ninterface VehicleSelectProps {\n  value?: string;\n  onChange: (value: string) => void;\n  className?: string;\n  placeholder?: string;\n  filter?: (vehicle: VehicleItem) => boolean;\n  required?: boolean;\n}\n\nexport function VehicleSelect({ value, onChange, className, placeholder = \"Selecione uma placa\", filter, required }: VehicleSelectProps) {\n  const { vehicles, loading } = useVehicles();\n\n  const filteredVehicles = filter ? vehicles.filter(filter) : vehicles;\n\n  return (\n    <Select value={value || \"\"} onValueChange={onChange} required={required}>\n      <SelectTrigger className={cn(\"w-full\", className)}>\n        <SelectValue placeholder={loading ? \"Carregando...\" : placeholder} />\n      </SelectTrigger>\n      <SelectContent>\n        {filteredVehicles.map((vehicle) => (\n          <SelectItem key={vehicle.plate} value={vehicle.plate}>\n            {vehicle.plate} {vehicle.model ? `- ${vehicle.model}` : \"\"}\n          </SelectItem>\n        ))}\n        {filteredVehicles.length === 0 && !loading && (\n          <SelectItem value=\"_empty\" disabled>\n            Nenhum veículo encontrado\n          </SelectItem>\n        )}\n      </SelectContent>\n    </Select>\n  );\n}\n"],"names":["mapVehicle","v","plate","placa","model","modelo","type","tipo","status","mileage","km","odometer","undefined","useVehicles","vehicles","setVehicles","useState","loading","setLoading","error","setError","load","data","supabase","from","select","mapped","map","filter","sort","a","b","localeCompare","length","demoMapped","demoList","e","message","useEffect","channel","on","event","schema","table","subscribe","removeChannel","refresh","getByPlate","find","VehicleSelect","value","onChange","className","placeholder","required","filteredVehicles","Select","jsx","SelectTrigger","cn","SelectValue","SelectContent","vehicle","jsxs","SelectItem"],"mappings":"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"}