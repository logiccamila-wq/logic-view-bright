import{a as te,r as A,s as g,d as w,j as e,B as _,U as re}from"./index-BiNiRHKa.js";import{t as Q,c as $,e as z,L as H,B as se,W as ae}from"./Layout-Dp_kOeVO.js";import{C as u,a as D,b as N,d as S}from"./card-TfuIT_5Q.js";import{T as ie,a as ne,b as F,c as T}from"./tabs-D0EqSZrJ.js";import{S as M}from"./StatCard-D_xC6Z5I.js";import{R as oe}from"./RevenueAnalysis-Doc0WAAX.js";import{D as q,S as ce,B as L}from"./badge-DNXvGi58.js";import{T as I,a as O,b as h,c as o,d as k,e as i}from"./table-BZVhxJnw.js";import{D as le,f as pe,a as Ce,b as me,c as de,e as he}from"./dialog-Cg8eQnwj.js";import{I as V}from"./input-CbZeJBr9.js";import{L as G}from"./label-UYjdQhGu.js";import{C as ue,F as xe}from"./index-DIpBNjZJ.js";import{C as Y}from"./circle-check-big-SjvrQ4v6.js";import{u as J}from"./useQuery-CFkLnJnT.js";import{L as ge}from"./loader-circle-B3QIm2JW.js";import{T as je}from"./trending-up-DqnRdfA9.js";import"./index-CwEJSXtc.js";import"./select-QQKt8PR4.js";import"./index-CDnZEIrr.js";import"./index-BjTUNxlL.js";import"./chevron-down-CMfBZ8DZ.js";import"./check-CRXfG46A.js";import"./user-DUMs6VdZ.js";import"./triangle-alert-DWEkvv_3.js";import"./warehouse-DuizGI0Y.js";import"./settings-ADCDQZ7C.js";import"./sparkles-Dn6_ZUdd.js";import"./switch-kUc4mnC_.js";import"./refresh-cw-CnJNWiAD.js";import"./download-7EUd8C-f.js";import"./circle-check-7lrHsNBP.js";import"./CartesianChart-hQJLzW7L.js";import"./index-dbfCPaLo.js";import"./LineChart-D7XxyMx4.js";import"./getRadiusAndStrokeWidthFromDot-CjiGgi48.js";import"./Area-DrhO8xWp.js";import"./trending-down-BJc73CKM.js";import"./target-C34BtU2x.js";import"./history-iASH-fby.js";import"./BarChart-BlPFXgTd.js";function ve(t,c){const C=Q(t);if(isNaN(c))return $(t,NaN);const l=C.getDate(),p=$(t,C.getTime());p.setMonth(C.getMonth()+c+1,0);const s=p.getDate();return l>=s?p:(C.setFullYear(p.getFullYear(),p.getMonth(),l),C)}function K(t){const c=Q(t);return c.setDate(1),c.setHours(0,0,0,0),c}function W(t,c){return ve(t,-1)}function we(){const{user:t}=te(),[c,C]=A.useState([]),[l,p]=A.useState(!0),[s,j]=A.useState(!1),[f,P]=A.useState(new Date().getMonth()+1),[x,B]=A.useState(new Date().getFullYear());A.useEffect(()=>{m()},[]);const m=async()=>{p(!0);try{const{data:r,error:n}=await g.from("driver_payroll").select(`
          *,
          profiles!driver_payroll_driver_id_fkey(full_name)
        `).order("ano",{ascending:!1}).order("mes",{ascending:!1});if(n)throw n;C(r)}catch(r){console.error("Erro ao carregar folhas:",r),w.error("Erro ao carregar folhas de pagamento")}finally{p(!1)}},E=async()=>{j(!0);try{const{error:r}=await g.functions.invoke("calculate-driver-payroll",{body:{mes:f,ano:x}});if(r)throw r;w.success("Folha de pagamento calculada com sucesso!"),m()}catch(r){console.error("Erro ao calcular folha:",r),w.error("Erro ao calcular folha de pagamento")}finally{j(!1)}},v=async r=>{try{const{error:n}=await g.from("driver_payroll").update({status:"aprovado",aprovado_por:t==null?void 0:t.id,data_aprovacao:new Date().toISOString()}).eq("id",r);if(n)throw n;w.success("Folha aprovada!"),m()}catch(n){console.error("Erro ao aprovar folha:",n),w.error("Erro ao aprovar folha")}},y=async r=>{try{const{error:n}=await g.from("driver_payroll").update({status:"pago",data_pagamento:new Date().toISOString()}).eq("id",r);if(n)throw n;w.success("Pagamento registrado!"),m()}catch(n){console.error("Erro ao registrar pagamento:",n),w.error("Erro ao registrar pagamento")}},b=r=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r),U=r=>{const n={calculado:{variant:"secondary",label:"Calculado"},aprovado:{variant:"default",label:"Aprovado"},pago:{variant:"outline",label:"Pago"}},R=n[r]||n.calculado;return e.jsx(L,{variant:R.variant,children:R.label})};return e.jsxs("div",{"trae-inspector-start-line":"168","trae-inspector-start-column":"4","trae-inspector-end-line":"365","trae-inspector-end-column":"10","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-6",children:[e.jsxs("div",{"trae-inspector-start-line":"169","trae-inspector-start-column":"6","trae-inspector-end-line":"223","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-between",children:[e.jsxs("div",{"trae-inspector-start-line":"170","trae-inspector-start-column":"8","trae-inspector-end-line":"173","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx("h2",{"trae-inspector-start-line":"171","trae-inspector-start-column":"10","trae-inspector-end-line":"171","trae-inspector-end-column":"68","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Folha%20de%20Pagamento%22%2C%22textStartLine%22%3A%22171%22%2C%22textStartColumn%22%3A%2245%22%2C%22textEndLine%22%3A%22171%22%2C%22textEndColumn%22%3A%2263%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold",children:"Folha de Pagamento"}),e.jsx("p",{"trae-inspector-start-line":"172","trae-inspector-start-column":"10","trae-inspector-end-line":"172","trae-inspector-end-column":"94","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Gest%C3%A3o%20de%20folhas%20e%20pagamentos%20de%20motoristas%22%2C%22textStartLine%22%3A%22172%22%2C%22textStartColumn%22%3A%2247%22%2C%22textEndLine%22%3A%22172%22%2C%22textEndColumn%22%3A%2290%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-muted-foreground",children:"Gestão de folhas e pagamentos de motoristas"})]}),e.jsxs(le,{children:[e.jsx(pe,{asChild:!0,children:e.jsxs(_,{size:"lg",children:[e.jsx(ue,{className:"mr-2 h-5 w-5"}),"Calcular Folha"]})}),e.jsxs(Ce,{children:[e.jsxs(me,{children:[e.jsx(de,{children:"Calcular Folha de Pagamento"}),e.jsx(he,{children:"Selecione o período para calcular a folha de todos os motoristas"})]}),e.jsxs("div",{"trae-inspector-start-line":"190","trae-inspector-start-column":"12","trae-inspector-end-line":"220","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-4",children:[e.jsxs("div",{"trae-inspector-start-line":"191","trae-inspector-start-column":"14","trae-inspector-end-line":"200","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(G,{children:"Mês"}),e.jsx(V,{type:"number",min:"1",max:"12",value:f,onChange:r=>P(Number(r.target.value))})]}),e.jsxs("div",{"trae-inspector-start-line":"202","trae-inspector-start-column":"14","trae-inspector-end-line":"211","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(G,{children:"Ano"}),e.jsx(V,{type:"number",min:"2020",max:"2030",value:x,onChange:r=>B(Number(r.target.value))})]}),e.jsx(_,{onClick:E,disabled:s,className:"w-full",children:s?"Calculando...":"Calcular Folha"})]})]})]})]}),e.jsxs("div",{"trae-inspector-start-line":"226","trae-inspector-start-column":"6","trae-inspector-end-line":"278","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[e.jsx(u,{className:"p-6",children:e.jsxs("div",{"trae-inspector-start-line":"228","trae-inspector-start-column":"10","trae-inspector-end-line":"240","trae-inspector-end-column":"16","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-4",children:[e.jsx(q,{className:"h-8 w-8 text-green-500"}),e.jsxs("div",{"trae-inspector-start-line":"230","trae-inspector-start-column":"12","trae-inspector-end-line":"239","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx("p",{"trae-inspector-start-line":"231","trae-inspector-start-column":"14","trae-inspector-end-line":"231","trae-inspector-end-column":"76","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Total%20a%20Pagar%22%2C%22textStartLine%22%3A%22231%22%2C%22textStartColumn%22%3A%2259%22%2C%22textEndLine%22%3A%22231%22%2C%22textEndColumn%22%3A%2272%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground",children:"Total a Pagar"}),e.jsx("p",{"trae-inspector-start-line":"232","trae-inspector-start-column":"14","trae-inspector-end-line":"238","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold",children:b(c.filter(r=>r.status!=="pago").reduce((r,n)=>r+Number(n.total_liquido),0))})]})]})}),e.jsx(u,{className:"p-6",children:e.jsxs("div",{"trae-inspector-start-line":"244","trae-inspector-start-column":"10","trae-inspector-end-line":"252","trae-inspector-end-column":"16","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-4",children:[e.jsx(xe,{className:"h-8 w-8 text-blue-500"}),e.jsxs("div",{"trae-inspector-start-line":"246","trae-inspector-start-column":"12","trae-inspector-end-line":"251","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx("p",{"trae-inspector-start-line":"247","trae-inspector-start-column":"14","trae-inspector-end-line":"247","trae-inspector-end-column":"79","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Folhas%20Pendentes%22%2C%22textStartLine%22%3A%22247%22%2C%22textStartColumn%22%3A%2259%22%2C%22textEndLine%22%3A%22247%22%2C%22textEndColumn%22%3A%2275%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground",children:"Folhas Pendentes"}),e.jsx("p",{"trae-inspector-start-line":"248","trae-inspector-start-column":"14","trae-inspector-end-line":"250","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold",children:c.filter(r=>r.status==="calculado").length})]})]})}),e.jsx(u,{className:"p-6",children:e.jsxs("div",{"trae-inspector-start-line":"256","trae-inspector-start-column":"10","trae-inspector-end-line":"264","trae-inspector-end-column":"16","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-4",children:[e.jsx(Y,{className:"h-8 w-8 text-purple-500"}),e.jsxs("div",{"trae-inspector-start-line":"258","trae-inspector-start-column":"12","trae-inspector-end-line":"263","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx("p",{"trae-inspector-start-line":"259","trae-inspector-start-column":"14","trae-inspector-end-line":"259","trae-inspector-end-column":"72","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Aprovadas%22%2C%22textStartLine%22%3A%22259%22%2C%22textStartColumn%22%3A%2259%22%2C%22textEndLine%22%3A%22259%22%2C%22textEndColumn%22%3A%2268%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground",children:"Aprovadas"}),e.jsx("p",{"trae-inspector-start-line":"260","trae-inspector-start-column":"14","trae-inspector-end-line":"262","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold",children:c.filter(r=>r.status==="aprovado").length})]})]})}),e.jsx(u,{className:"p-6",children:e.jsxs("div",{"trae-inspector-start-line":"268","trae-inspector-start-column":"10","trae-inspector-end-line":"276","trae-inspector-end-column":"16","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-4",children:[e.jsx(q,{className:"h-8 w-8 text-gray-500"}),e.jsxs("div",{"trae-inspector-start-line":"270","trae-inspector-start-column":"12","trae-inspector-end-line":"275","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx("p",{"trae-inspector-start-line":"271","trae-inspector-start-column":"14","trae-inspector-end-line":"271","trae-inspector-end-column":"68","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Pagas%22%2C%22textStartLine%22%3A%22271%22%2C%22textStartColumn%22%3A%2259%22%2C%22textEndLine%22%3A%22271%22%2C%22textEndColumn%22%3A%2264%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground",children:"Pagas"}),e.jsx("p",{"trae-inspector-start-line":"272","trae-inspector-start-column":"14","trae-inspector-end-line":"274","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold",children:c.filter(r=>r.status==="pago").length})]})]})})]}),e.jsx(u,{children:e.jsxs("div",{"trae-inspector-start-line":"282","trae-inspector-start-column":"8","trae-inspector-end-line":"363","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"p-6",children:[e.jsx("h3",{"trae-inspector-start-line":"283","trae-inspector-start-column":"10","trae-inspector-end-line":"283","trae-inspector-end-column":"77","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Folhas%20de%20Pagamento%22%2C%22textStartLine%22%3A%22283%22%2C%22textStartColumn%22%3A%2253%22%2C%22textEndLine%22%3A%22283%22%2C%22textEndColumn%22%3A%2272%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-lg font-semibold mb-4",children:"Folhas de Pagamento"}),l?e.jsx("div",{"trae-inspector-start-line":"286","trae-inspector-start-column":"12","trae-inspector-end-line":"290","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-2",children:[1,2,3].map(r=>e.jsx(ce,{className:"h-12 w-full"},r))}):e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(h,{children:[e.jsx(o,{children:"Motorista"}),e.jsx(o,{children:"Período"}),e.jsx(o,{children:"Salário Base"}),e.jsx(o,{children:"Horas"}),e.jsx(o,{children:"Gratificação"}),e.jsx(o,{children:"Total Líquido"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Ações"})]})}),e.jsx(k,{children:c.length===0?e.jsx(h,{children:e.jsx(i,{colSpan:8,className:"text-center text-muted-foreground py-8",children:"Nenhuma folha calculada ainda"})}):c.map(r=>{var n;return e.jsxs(h,{children:[e.jsx(i,{className:"font-medium",children:((n=r.profiles)==null?void 0:n.full_name)||"N/A"}),e.jsxs(i,{children:[String(r.mes).padStart(2,"0"),"/",r.ano]}),e.jsx(i,{children:b(Number(r.salario_base))}),e.jsx(i,{children:e.jsxs("div",{"trae-inspector-start-line":"323","trae-inspector-start-column":"24","trae-inspector-end-line":"326","trae-inspector-end-column":"30","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-xs",children:[e.jsxs("div",{"trae-inspector-start-line":"324","trae-inspector-start-column":"26","trae-inspector-end-line":"324","trae-inspector-end-column":"89","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:["Normais: ",Number(r.horas_normais).toFixed(1),"h"]}),e.jsxs("div",{"trae-inspector-start-line":"325","trae-inspector-start-column":"26","trae-inspector-end-line":"325","trae-inspector-end-column":"87","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:["Extras: ",Number(r.horas_extras).toFixed(1),"h"]})]})}),e.jsx(i,{children:b(Number(r.valor_gratificacao))}),e.jsx(i,{className:"font-bold text-green-600",children:b(Number(r.total_liquido))}),e.jsx(i,{children:U(r.status)}),e.jsx(i,{children:e.jsxs("div",{"trae-inspector-start-line":"334","trae-inspector-start-column":"24","trae-inspector-end-line":"355","trae-inspector-end-column":"30","trae-inspector-file-path":"src\\\\components\\\\erp\\\\PayrollSection.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex gap-2",children:[r.status==="calculado"&&e.jsxs(_,{size:"sm",variant:"default",onClick:()=>v(r.id),children:[e.jsx(Y,{className:"h-4 w-4 mr-1"}),"Aprovar"]}),r.status==="aprovado"&&e.jsxs(_,{size:"sm",variant:"secondary",onClick:()=>y(r.id),children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Pagar"]})]})})]},r.id)})})]})]})})]})}const fe=()=>J({queryKey:["financial-data"],queryFn:async()=>{const t=new Date,c=K(t),C=z(t),l=K(W(t)),p=z(W(t)),{data:s,error:j}=await g.from("cte").select("valor_total, data_emissao").eq("status","autorizado").gte("data_emissao",c.toISOString()).lte("data_emissao",C.toISOString());if(j)throw j;const{data:f,error:P}=await g.from("cte").select("valor_total").eq("status","autorizado").gte("data_emissao",l.toISOString()).lte("data_emissao",p.toISOString());if(P)throw P;const{data:x,error:B}=await g.from("contas_receber").select("valor, status, data_vencimento, cliente, descricao, created_at").order("created_at",{ascending:!1});if(B)throw B;const{data:m,error:E}=await g.from("contas_pagar").select("valor, status, data_vencimento, fornecedor, descricao, created_at, categoria").order("created_at",{ascending:!1});if(E)throw E;const v=(s==null?void 0:s.reduce((a,d)=>a+Number(d.valor_total),0))||0,y=(f==null?void 0:f.reduce((a,d)=>a+Number(d.valor_total),0))||0,b=y>0?(v-y)/y*100:0,U=(m==null?void 0:m.filter(a=>{const d=new Date(a.created_at);return d>=c&&d<=C}).reduce((a,d)=>a+Number(d.valor),0))||0,r=v-U,n=v>0?r/v*100:0,R=(x==null?void 0:x.filter(a=>a.status==="pendente").reduce((a,d)=>a+Number(d.valor),0))||0,X=(x==null?void 0:x.slice(0,10).map(a=>({id:a.created_at,data:new Date(a.created_at).toISOString().split("T")[0],descricao:a.descricao,tipo:"receita",valor:Number(a.valor),categoria:"Receita Operacional",status:a.status})))||[],Z=(m==null?void 0:m.slice(0,10).map(a=>({id:a.created_at,data:new Date(a.created_at).toISOString().split("T")[0],descricao:a.descricao,tipo:"despesa",valor:Number(a.valor),categoria:a.categoria||"Despesa Operacional",status:a.status})))||[],ee=[...X,...Z].sort((a,d)=>new Date(d.data).getTime()-new Date(a.data).getTime()).slice(0,20);return{receitaMesAtual:v,variacaoReceita:b,despesasMes:U,lucroLiquido:r,margemLiquida:n,receitaPendente:R,totalCtes:(s==null?void 0:s.length)||0,lancamentos:ee,contasReceber:x||[],contasPagar:m||[]}},refetchInterval:3e4}),ct=()=>{const{data:t,isLoading:c}=fe(),{data:C}=J({queryKey:["users-count"],queryFn:async()=>{const{count:s,error:j}=await g.from("profiles").select("*",{count:"exact",head:!0});if(j)throw j;return s||0}});if(c)return e.jsx(H,{children:e.jsx("div",{"trae-inspector-start-line":"47","trae-inspector-start-column":"8","trae-inspector-end-line":"49","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-center h-96",children:e.jsx(ge,{className:"w-8 h-8 animate-spin text-primary"})})});const l=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),p=s=>s>=1e6?`R$ ${(s/1e6).toFixed(2)}M`:s>=1e3?`R$ ${(s/1e3).toFixed(0)}k`:l(s);return e.jsx(H,{children:e.jsxs("div",{"trae-inspector-start-line":"72","trae-inspector-start-column":"6","trae-inspector-end-line":"324","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-6",children:[e.jsxs("div",{"trae-inspector-start-line":"73","trae-inspector-start-column":"8","trae-inspector-end-line":"78","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx("h1",{"trae-inspector-start-line":"74","trae-inspector-start-column":"10","trae-inspector-end-line":"74","trae-inspector-end-column":"84","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22ERP%20-%20Enterprise%20Resource%20Planning%22%2C%22textStartLine%22%3A%2274%22%2C%22textStartColumn%22%3A%2245%22%2C%22textEndLine%22%3A%2274%22%2C%22textEndColumn%22%3A%2279%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-3xl font-bold",children:"ERP - Enterprise Resource Planning"}),e.jsx("p",{"trae-inspector-start-line":"75","trae-inspector-start-column":"10","trae-inspector-end-line":"77","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Sistema%20Integrado%20de%20Gest%C3%A3o%20Empresarial%22%2C%22textStartLine%22%3A%2275%22%2C%22textStartColumn%22%3A%2252%22%2C%22textEndLine%22%3A%2277%22%2C%22textEndColumn%22%3A%2210%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-muted-foreground mt-2",children:"Sistema Integrado de Gestão Empresarial"})]}),e.jsxs("div",{"trae-inspector-start-line":"81","trae-inspector-start-column":"8","trae-inspector-end-line":"110","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(M,{title:"Faturamento Mês",value:p((t==null?void 0:t.receitaMesAtual)||0),icon:q,trend:{value:`${(t==null?void 0:t.variacaoReceita)>=0?"+":""}${t==null?void 0:t.variacaoReceita.toFixed(1)}% vs mês anterior`,positive:((t==null?void 0:t.variacaoReceita)||0)>=0}}),e.jsx(M,{title:"Margem Líquida",value:`${t==null?void 0:t.margemLiquida.toFixed(1)}%`,icon:je,trend:{value:`${(t==null?void 0:t.totalCtes)||0} CT-es`,positive:!0}}),e.jsx(M,{title:"Colaboradores",value:C||0,icon:re}),e.jsx(M,{title:"Contas a Receber",value:p((t==null?void 0:t.receitaPendente)||0),icon:se})]}),e.jsxs(ie,{defaultValue:"financeiro",className:"w-full",children:[e.jsxs(ne,{className:"grid w-full grid-cols-4",children:[e.jsx(F,{value:"financeiro",children:"Financeiro"}),e.jsx(F,{value:"receita",children:"Análise de Receita"}),e.jsx(F,{value:"contas",children:"Contas a Receber/Pagar"}),e.jsxs(F,{value:"folha",children:[e.jsx(ae,{className:"w-4 h-4 mr-2"}),"Folha de Pagamento"]})]}),e.jsxs(T,{value:"financeiro",className:"space-y-4",children:[e.jsxs("div",{"trae-inspector-start-line":"126","trae-inspector-start-column":"12","trae-inspector-end-line":"168","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(u,{children:[e.jsx(D,{children:e.jsx(N,{className:"text-sm",children:"Receitas"})}),e.jsxs(S,{children:[e.jsx("p",{"trae-inspector-start-line":"132","trae-inspector-start-column":"18","trae-inspector-end-line":"134","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-3xl font-bold text-green-600",children:l((t==null?void 0:t.receitaMesAtual)||0)}),e.jsx("p",{"trae-inspector-start-line":"135","trae-inspector-start-column":"18","trae-inspector-end-line":"137","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground mt-2",children:new Date().toLocaleDateString("pt-BR",{month:"long",year:"numeric"})})]})]}),e.jsxs(u,{children:[e.jsx(D,{children:e.jsx(N,{className:"text-sm",children:"Despesas"})}),e.jsxs(S,{children:[e.jsx("p",{"trae-inspector-start-line":"146","trae-inspector-start-column":"18","trae-inspector-end-line":"148","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-3xl font-bold text-red-600",children:l((t==null?void 0:t.despesasMes)||0)}),e.jsx("p",{"trae-inspector-start-line":"149","trae-inspector-start-column":"18","trae-inspector-end-line":"151","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground mt-2",children:new Date().toLocaleDateString("pt-BR",{month:"long",year:"numeric"})})]})]}),e.jsxs(u,{children:[e.jsx(D,{children:e.jsx(N,{className:"text-sm",children:"Lucro Líquido"})}),e.jsxs(S,{children:[e.jsx("p",{"trae-inspector-start-line":"160","trae-inspector-start-column":"18","trae-inspector-end-line":"162","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-3xl font-bold text-blue-600",children:l((t==null?void 0:t.lucroLiquido)||0)}),e.jsxs("p",{"trae-inspector-start-line":"163","trae-inspector-start-column":"18","trae-inspector-end-line":"165","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground mt-2",children:[t==null?void 0:t.margemLiquida.toFixed(1),"% de margem"]})]})]})]}),e.jsxs(u,{children:[e.jsx(D,{children:e.jsx(N,{children:"Lançamentos Recentes"})}),e.jsx(S,{children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(h,{children:[e.jsx(o,{children:"Data"}),e.jsx(o,{children:"Descrição"}),e.jsx(o,{children:"Categoria"}),e.jsx(o,{children:"Tipo"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"text-right",children:"Valor"})]})}),e.jsx(k,{children:(t==null?void 0:t.lancamentos.length)===0?e.jsx(h,{children:e.jsx(i,{colSpan:6,className:"text-center text-muted-foreground py-8",children:"Nenhum lançamento encontrado. Importe CT-es para visualizar receitas."})}):t==null?void 0:t.lancamentos.map(s=>e.jsxs(h,{children:[e.jsx(i,{children:new Date(s.data).toLocaleDateString("pt-BR")}),e.jsx(i,{className:"max-w-xs truncate",children:s.descricao}),e.jsx(i,{children:e.jsx(L,{variant:"outline",children:s.categoria})}),e.jsx(i,{children:e.jsx(L,{variant:s.tipo==="receita"?"default":"secondary",children:s.tipo==="receita"?"Receita":"Despesa"})}),e.jsx(i,{children:e.jsx(L,{variant:s.status==="pago"?"default":"outline",children:s.status})}),e.jsx(i,{className:`text-right font-medium ${s.tipo==="receita"?"text-green-600":"text-red-600"}`,children:l(s.valor)})]},s.id))})]})})]})]}),e.jsx(T,{value:"receita",children:e.jsx(oe,{})}),e.jsx(T,{value:"contas",className:"space-y-4",children:e.jsxs("div",{"trae-inspector-start-line":"232","trae-inspector-start-column":"12","trae-inspector-end-line":"316","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\pages\\\\ERP.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(u,{children:[e.jsx(D,{children:e.jsx(N,{children:"Contas a Receber"})}),e.jsx(S,{children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(h,{children:[e.jsx(o,{children:"Cliente"}),e.jsx(o,{children:"Vencimento"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"text-right",children:"Valor"})]})}),e.jsx(k,{children:(t==null?void 0:t.contasReceber.length)===0?e.jsx(h,{children:e.jsx(i,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"Nenhuma conta a receber"})}):t==null?void 0:t.contasReceber.slice(0,10).map(s=>e.jsxs(h,{children:[e.jsx(i,{className:"max-w-xs truncate",children:s.cliente}),e.jsx(i,{children:new Date(s.data_vencimento).toLocaleDateString("pt-BR")}),e.jsx(i,{children:e.jsx(L,{variant:s.status==="pago"?"default":"outline",children:s.status})}),e.jsx(i,{className:"text-right font-medium text-green-600",children:l(Number(s.valor))})]},s.created_at))})]})})]}),e.jsxs(u,{children:[e.jsx(D,{children:e.jsx(N,{children:"Contas a Pagar"})}),e.jsx(S,{children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsxs(h,{children:[e.jsx(o,{children:"Fornecedor"}),e.jsx(o,{children:"Vencimento"}),e.jsx(o,{children:"Status"}),e.jsx(o,{className:"text-right",children:"Valor"})]})}),e.jsx(k,{children:(t==null?void 0:t.contasPagar.length)===0?e.jsx(h,{children:e.jsx(i,{colSpan:4,className:"text-center text-muted-foreground py-8",children:"Nenhuma conta a pagar"})}):t==null?void 0:t.contasPagar.slice(0,10).map(s=>e.jsxs(h,{children:[e.jsx(i,{className:"max-w-xs truncate",children:s.fornecedor}),e.jsx(i,{children:new Date(s.data_vencimento).toLocaleDateString("pt-BR")}),e.jsx(i,{children:e.jsx(L,{variant:s.status==="pago"?"default":"outline",children:s.status})}),e.jsx(i,{className:"text-right font-medium text-red-600",children:l(Number(s.valor))})]},s.created_at))})]})})]})]})}),e.jsx(T,{value:"folha",children:e.jsx(we,{})})]})]})})};export{ct as default};
