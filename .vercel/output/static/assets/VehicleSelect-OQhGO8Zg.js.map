{"version":3,"file":"VehicleSelect-OQhGO8Zg.js","sources":["../../src/lib/hooks/useVehicles.ts","../../src/components/VehicleSelect.tsx"],"sourcesContent":["import { useEffect, useState } from 'react';\nimport { supabase } from '@/integrations/supabase/client';\nimport { demoList } from '@/lib/demoStore';\n\nexport type VehicleItem = {\n  plate: string;\n  model?: string;\n  type?: string;\n  status?: string;\n  mileage?: number;\n};\n\nfunction mapVehicle(v: any): VehicleItem {\n  const plate = v?.placa || v?.plate || '';\n  const model = v?.modelo || v?.model || '';\n  const type = v?.tipo || v?.type || '';\n  const status = v?.status || '';\n  const mileage = v?.km || v?.mileage || v?.odometer || undefined;\n  return { plate, model, type, status, mileage };\n}\n\nexport function useVehicles() {\n  const [vehicles, setVehicles] = useState<VehicleItem[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n\n  const load = async () => {\n    setLoading(true); setError('');\n    try {\n      const { data, error } = await supabase.from('vehicles').select('*');\n      if (error) throw error;\n      let mapped = (data || [])\n        .map(mapVehicle)\n        .filter(v => !!v.plate);\n      \n      // Remove duplicates based on plate\n      mapped = [...new Map(mapped.map(item => [item.plate, item])).values()];\n      \n      mapped.sort((a, b) => a.plate.localeCompare(b.plate));\n\n      if (mapped.length === 0) {\n        // Fallback to demo data if DB is empty\n        const demo = demoList('vehicles') || [];\n        const demoMapped = demo.map(mapVehicle).filter(v => !!v.plate);\n        \n        if (demoMapped.length > 0) {\n          mapped = demoMapped;\n        } else {\n           // Default fallback list\n           mapped = [\n             { plate: 'ABC-1234', model: 'Volvo FH 540', type: 'Caminhão', status: 'Ativo' },\n             { plate: 'DEF-5678', model: 'Scania R450', type: 'Caminhão', status: 'Ativo' },\n             { plate: 'GHI-9012', model: 'Mercedes-Benz Actros', type: 'Caminhão', status: 'Manutenção' },\n             { plate: 'JKL-3456', model: 'DAF XF', type: 'Caminhão', status: 'Ativo' },\n             { plate: 'MNO-7890', model: 'Volkswagen Meteor', type: 'Caminhão', status: 'Ativo' },\n             { plate: 'PQR-1234', model: 'Iveco S-Way', type: 'Caminhão', status: 'Ativo' },\n             { plate: 'EJG-1234', model: 'Demo Truck', type: 'Caminhão', status: 'Ativo' }\n           ];\n        }\n      }\n      \n      setVehicles(mapped);\n    } catch (e: any) {\n      const demo = demoList('vehicles') || [];\n      const mapped = demo.map(mapVehicle);\n      setVehicles(mapped.length ? mapped : [\n         { plate: 'ABC-1234', model: 'Volvo FH 540', type: 'Caminhão', status: 'Ativo' },\n         { plate: 'DEF-5678', model: 'Scania R450', type: 'Caminhão', status: 'Ativo' },\n         { plate: 'EJG-1234', model: 'Demo Truck', type: 'Caminhão', status: 'Ativo' }\n      ]);\n      setError(e?.message || 'Falha ao carregar veículos');\n    } finally { setLoading(false); }\n  };\n\n  useEffect(() => {\n    load();\n    const channel = supabase\n      .channel('vehicles_changes')\n      .on('postgres_changes', { event: '*', schema: 'public', table: 'vehicles' }, () => load())\n      .subscribe();\n    return () => { supabase.removeChannel(channel); };\n  }, []);\n\n  const getByPlate = (plate: string) => vehicles.find(v => v.plate === plate);\n\n  return { vehicles, loading, error, refresh: load, getByPlate };\n}\n\n","import {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport { useVehicles, VehicleItem } from \"@/lib/hooks/useVehicles\";\nimport { cn } from \"@/lib/utils\";\n\ninterface VehicleSelectProps {\n  value?: string;\n  onChange: (value: string) => void;\n  onSelectVehicle?: (vehicle: VehicleItem) => void;\n  className?: string;\n  placeholder?: string;\n  filter?: (vehicle: VehicleItem) => boolean;\n  required?: boolean;\n}\n\nexport function VehicleSelect({ value, onChange, onSelectVehicle, className, placeholder = \"Selecione uma placa\", filter, required }: VehicleSelectProps) {\n  const { vehicles, loading } = useVehicles();\n\n  const filteredVehicles = filter ? vehicles.filter(filter) : vehicles;\n\n  return (\n    <Select \n      value={value || \"\"} \n      onValueChange={(val) => {\n        onChange(val);\n        if (onSelectVehicle) {\n          const v = vehicles.find(item => item.plate === val);\n          if (v) onSelectVehicle(v);\n        }\n      }} \n      required={required}\n    >\n      <SelectTrigger className={cn(\"w-full\", className)}>\n        <SelectValue placeholder={loading ? \"Carregando...\" : placeholder} />\n      </SelectTrigger>\n      <SelectContent>\n        {filteredVehicles.map((vehicle) => (\n          <SelectItem key={vehicle.plate} value={vehicle.plate}>\n            {vehicle.plate} {vehicle.model ? `- ${vehicle.model}` : \"\"}\n          </SelectItem>\n        ))}\n        {filteredVehicles.length === 0 && !loading && (\n          <SelectItem value=\"_empty\" disabled>\n            Nenhum veículo encontrado\n          </SelectItem>\n        )}\n      </SelectContent>\n    </Select>\n  );\n}\n"],"names":["mapVehicle","v","plate","placa","model","modelo","type","tipo","status","mileage","km","odometer","undefined","useVehicles","vehicles","setVehicles","useState","loading","setLoading","error","setError","load","data","supabase","from","select","mapped","map","filter","Map","item","values","sort","a","b","localeCompare","length","demoMapped","demoList","e","message","useEffect","channel","on","event","schema","table","subscribe","removeChannel","refresh","getByPlate","find","VehicleSelect","value","onChange","onSelectVehicle","className","placeholder","required","filteredVehicles","Select","val","jsx","SelectTrigger","cn","SelectValue","SelectContent","vehicle","jsxs","SelectItem"],"mappings":"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"}