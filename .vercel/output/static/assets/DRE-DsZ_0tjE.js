import{c as Q,j as e,r as m,s as y,d as J,L as Z}from"./index-C8gJK6VO.js";import{C as h,a as f,b as D,d as x}from"./card-XpOOVLWI.js";import{L as B}from"./label-C3geKGxC.js";import{S as T,a as k,b as F,c as U,d as g}from"./select-CgN7rKuh.js";import{R as ee,T as te,L as se}from"./CategoricalChart-C2-bnGS6.js";import{a as re,L as I}from"./LineChart-Chu0Q6MQ.js";import{a as ae,X as ie,Y as ne}from"./CartesianChart-sJGvtODh.js";import{T as ce,a as oe,b as V,c as j,d as le,e as p}from"./table-Duog4cWS.js";import{B as de}from"./badge-CRfFogl7.js";import{T as q}from"./trending-up-DWFUeL7W.js";import{T as me}from"./trending-down-Bwvyf_cf.js";import{D as pe}from"./dollar-sign-C1fvDVSy.js";import"./Combination-BQvqHitJ.js";import"./index-C9UnwKLR.js";import"./index-XPvY48Nz.js";import"./chevron-down-ChCbnXTB.js";import"./check-CMTAF2ib.js";import"./index-De_FPpeP.js";import"./getRadiusAndStrokeWidthFromDot-BovFsRfD.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],he=Q("funnel",Ce);function xe({data:o}){const C=c=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(c);return e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(D,{children:"Evolução Financeira"})}),e.jsx(x,{children:e.jsx(ee,{width:"100%",height:300,children:e.jsxs(re,{data:o,children:[e.jsx(ae,{strokeDasharray:"3 3",className:"stroke-muted"}),e.jsx(ie,{dataKey:"mes",className:"text-sm",tick:{fill:"hsl(var(--foreground))"}}),e.jsx(ne,{tickFormatter:C,className:"text-sm",tick:{fill:"hsl(var(--foreground))"}}),e.jsx(te,{formatter:c=>C(c),contentStyle:{backgroundColor:"hsl(var(--background))",border:"1px solid hsl(var(--border))",borderRadius:"6px"}}),e.jsx(se,{}),e.jsx(I,{type:"monotone",dataKey:"receitas",stroke:"hsl(var(--primary))",strokeWidth:2,name:"Receitas",dot:{fill:"hsl(var(--primary))"}}),e.jsx(I,{type:"monotone",dataKey:"despesas",stroke:"hsl(142, 76%, 36%)",strokeWidth:2,name:"Despesas",dot:{fill:"hsl(142, 76%, 36%)"}}),e.jsx(I,{type:"monotone",dataKey:"lucro",stroke:"hsl(221, 83%, 53%)",strokeWidth:2,name:"Lucro",dot:{fill:"hsl(221, 83%, 53%)"}})]})})})]})}function ue({entries:o}){const C=a=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(a),c=a=>new Date(a).toLocaleDateString("pt-BR"),A=a=>a==="RECEITA"?"bg-green-500/20 text-green-600":"bg-red-500/20 text-red-600",R=o.reduce((a,n)=>(a[n.categoria]||(a[n.categoria]=[]),a[n.categoria].push(n),a),{});return e.jsxs(h,{children:[e.jsx(f,{children:e.jsx(D,{children:"Detalhamento DRE"})}),e.jsx(x,{children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(V,{children:[e.jsx(j,{children:"Data"}),e.jsx(j,{children:"Categoria"}),e.jsx(j,{children:"Subcategoria"}),e.jsx(j,{children:"Descrição"}),e.jsx(j,{children:"Tipo"}),e.jsx(j,{className:"text-right",children:"Valor"})]})}),e.jsx(le,{children:Object.entries(R).map(([a,n])=>e.jsxs(e.Fragment,{children:[e.jsxs(V,{className:"bg-muted/50",children:[e.jsx(p,{colSpan:5,className:"font-bold",children:a}),e.jsx(p,{className:"text-right font-bold",children:C(n.reduce((i,l)=>i+(l.tipo==="RECEITA"?l.valor:-l.valor),0))})]},a),n.map(i=>e.jsxs(V,{children:[e.jsx(p,{className:"text-sm",children:c(i.data)}),e.jsx(p,{children:i.categoria}),e.jsx(p,{className:"text-sm text-muted-foreground",children:i.subcategoria||"-"}),e.jsx(p,{className:"text-sm",children:i.descricao||"-"}),e.jsx(p,{children:e.jsx(de,{className:A(i.tipo),children:i.tipo})}),e.jsxs(p,{className:"text-right font-medium",children:[i.tipo==="RECEITA"?"+":"-",C(i.valor)]})]},i.id))]}))})]})})]})}const Ie=()=>{const[o,C]=m.useState([]),[c,A]=m.useState([]),[R,a]=m.useState([]),[n,i]=m.useState(!0),[l,H]=m.useState(new Date().getFullYear().toString()),[$,K]=m.useState("ano"),[w,P]=m.useState("todos");m.useEffect(()=>{G()},[l,$,w]);const G=async()=>{i(!0);try{const t=`${l}-01-01`,s=`${l}-12-31`,{data:r,error:E}=await y.from("dre_entries").select("*").gte("data",t).lte("data",s).order("data",{ascending:!1});if(E)throw E;let u=y.from("lancamentos_financeiros").select("*").gte("data",t).lte("data",s);w!=="todos"&&(u=u.eq("vehicle_placa",w));const{data:S,error:b}=await u;if(b)throw b;const{data:O,error:_}=await y.from("vehicles").select("*").in("status",["ativo","Ativo"]);_&&console.error("Erro ao carregar veículos:",_),C(r||[]),A(S||[]);const X=(O||[]).map(d=>({placa:d.placa||d.plate,modelo:d.modelo||d.model||""})).filter(d=>!!d.placa).sort((d,z)=>d.placa.localeCompare(z.placa));a(X)}catch(t){J.error(`Erro ao carregar DRE: ${t.message}`)}finally{i(!1)}},v=[...o.filter(t=>t.tipo==="RECEITA"),...c.filter(t=>t.tipo==="entrada")].reduce((t,s)=>t+s.valor,0),Y=[...o.filter(t=>t.tipo==="DESPESA"),...c.filter(t=>t.tipo==="saida")].reduce((t,s)=>t+s.valor,0),N=v-Y,M=v>0?N/v*100:0,L=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(t),W=()=>{const t={};return o.forEach(s=>{const r=new Date(s.data).toLocaleDateString("pt-BR",{month:"short",year:"2-digit"});t[r]||(t[r]={receitas:0,despesas:0}),s.tipo==="RECEITA"?t[r].receitas+=s.valor:t[r].despesas+=s.valor}),c.forEach(s=>{const r=new Date(s.data).toLocaleDateString("pt-BR",{month:"short",year:"2-digit"});t[r]||(t[r]={receitas:0,despesas:0}),s.tipo==="entrada"?t[r].receitas+=s.valor:t[r].despesas+=s.valor}),Object.entries(t).map(([s,r])=>({mes:s,receitas:r.receitas,despesas:r.despesas,lucro:r.receitas-r.despesas})).sort((s,r)=>{const[E,u]=s.mes.split(" "),[S,b]=r.mes.split(" ");return u===b?new Date(`${E} 1`).getTime()-new Date(`${S} 1`).getTime():Number(u)-Number(b)})};return e.jsx(Z,{children:e.jsxs("div",{"trae-inspector-start-line":"158","trae-inspector-start-column":"6","trae-inspector-end-line":"268","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-6",children:[e.jsx("div",{"trae-inspector-start-line":"159","trae-inspector-start-column":"8","trae-inspector-end-line":"161","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-between",children:e.jsx("h1",{"trae-inspector-start-line":"160","trae-inspector-start-column":"10","trae-inspector-end-line":"160","trae-inspector-end-column":"83","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22DRE%20-%20Demonstrativo%20de%20Resultados%22%2C%22textStartLine%22%3A%22160%22%2C%22textStartColumn%22%3A%2245%22%2C%22textEndLine%22%3A%22160%22%2C%22textEndColumn%22%3A%2278%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-3xl font-bold",children:"DRE - Demonstrativo de Resultados"})}),e.jsx(h,{children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{"trae-inspector-start-line":"166","trae-inspector-start-column":"12","trae-inspector-end-line":"214","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-4",children:[e.jsx(he,{className:"w-5 h-5 text-muted-foreground"}),e.jsxs("div",{"trae-inspector-start-line":"168","trae-inspector-start-column":"14","trae-inspector-end-line":"213","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex-1 grid grid-cols-3 gap-4",children:[e.jsxs("div",{"trae-inspector-start-line":"169","trae-inspector-start-column":"16","trae-inspector-end-line":"183","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(B,{htmlFor:"year",children:"Ano"}),e.jsxs(T,{value:l,onValueChange:H,children:[e.jsx(k,{children:e.jsx(F,{placeholder:"Selecione o ano"})}),e.jsx(U,{children:[2023,2024,2025].map(t=>e.jsx(g,{value:t.toString(),children:t},t))})]})]}),e.jsxs("div",{"trae-inspector-start-line":"184","trae-inspector-start-column":"16","trae-inspector-end-line":"196","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(B,{htmlFor:"period",children:"Período"}),e.jsxs(T,{value:$,onValueChange:K,children:[e.jsx(k,{children:e.jsx(F,{placeholder:"Selecione o período"})}),e.jsxs(U,{children:[e.jsx(g,{value:"mes",children:"Mensal"}),e.jsx(g,{value:"trimestre",children:"Trimestral"}),e.jsx(g,{value:"ano",children:"Anual"})]})]})]}),e.jsxs("div",{"trae-inspector-start-line":"197","trae-inspector-start-column":"16","trae-inspector-end-line":"212","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(B,{htmlFor:"vehicle",children:"Veículo"}),e.jsxs(T,{value:w,onValueChange:P,children:[e.jsx(k,{children:e.jsx(F,{placeholder:"Todos os veículos"})}),e.jsxs(U,{children:[e.jsx(g,{value:"todos",children:"Todos os veículos"}),R.map(t=>e.jsxs(g,{value:t.placa,children:[t.placa," - ",t.modelo]},t.placa))]})]})]})]})]})})}),e.jsxs("div",{"trae-inspector-start-line":"219","trae-inspector-start-column":"8","trae-inspector-end-line":"261","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Receitas"}),e.jsx(q,{className:"h-4 w-4 text-green-500"})]}),e.jsx(x,{children:e.jsx("div",{"trae-inspector-start-line":"226","trae-inspector-start-column":"14","trae-inspector-end-line":"226","trae-inspector-end-column":"102","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold text-green-500",children:L(v)})})]}),e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Despesas"}),e.jsx(me,{className:"h-4 w-4 text-red-500"})]}),e.jsx(x,{children:e.jsx("div",{"trae-inspector-start-line":"236","trae-inspector-start-column":"14","trae-inspector-end-line":"236","trae-inspector-end-column":"100","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold text-red-500",children:L(Y)})})]}),e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Lucro Líquido"}),e.jsx(pe,{className:"h-4 w-4"})]}),e.jsx(x,{children:e.jsx("div",{"trae-inspector-start-line":"246","trae-inspector-start-column":"14","trae-inspector-end-line":"248","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:`text-2xl font-bold ${N>=0?"text-green-500":"text-red-500"}`,children:L(N)})})]}),e.jsxs(h,{children:[e.jsxs(f,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(D,{className:"text-sm font-medium",children:"Margem de Lucro"}),e.jsx(q,{className:"h-4 w-4"})]}),e.jsx(x,{children:e.jsxs("div",{"trae-inspector-start-line":"258","trae-inspector-start-column":"14","trae-inspector-end-line":"258","trae-inspector-end-column":"81","trae-inspector-file-path":"src\\\\pages\\\\DRE.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold",children:[M.toFixed(1),"%"]})})]})]}),!n&&e.jsx(xe,{data:W()}),!n&&e.jsx(ue,{entries:o})]})})};export{Ie as default};
