import{c as X,r as m,a0 as F,j as e,B as v,X as K,ab as H}from"./index-C8gJK6VO.js";import{I as V}from"./input-D5Ccm-s1.js";import{C as $,a as Z,b as _,d as Y}from"./card-XpOOVLWI.js";import{S as f}from"./sparkles-Blg3jjmz.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]],q=X("send",Q),ae=({dashboardData:k})=>{const[J,N]=m.useState(!1),[w,b]=m.useState([{role:"assistant",content:"Olá! Sou Gael, sua consultora de IA do OptiLog. Como posso ajudar você hoje com análises estratégicas, insights financeiros ou recomendações operacionais?"}]),[h,D]=m.useState(""),[u,y]=m.useState(!1),x=m.useRef(null),{toast:z}=F();m.useEffect(()=>{x.current&&(x.current.scrollTop=x.current.scrollHeight)},[w]);const M=async t=>{var A,I,L,S,E,B;const l="https://anppdwjpetvvfnhxkrpy.supabase.co/functions/v1/gael-chat";try{const s=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVpeGt2a3N0dGFkaHVrdWNvaGRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM0MzgxMDUsImV4cCI6MjA3OTAxNDEwNX0.FKcjSUGJmrh1BJMcFe08XEDKJPJ5CrW-0dKIet2hXuw"},body:JSON.stringify({messages:t,dashboardData:k})});if(!s.ok){const i=s.headers.get("content-type")||"";let a="Falha ao conectar com a IA";throw i.includes("application/json")?a=(await s.json()).error||a:a=await s.text()||a,new Error(a)}if(!s.body)throw new Error("Sem resposta do servidor");const P=s.body.getReader(),R=new TextDecoder;let n="",U=!1,C="";for(;!U;){const{done:i,value:a}=await P.read();if(i)break;n+=R.decode(a,{stream:!0});let p;for(;(p=n.indexOf(`
`))!==-1;){let r=n.slice(0,p);if(n=n.slice(p+1),r.endsWith("\r")&&(r=r.slice(0,-1)),r.startsWith(":")||r.trim()===""||!r.startsWith("data: "))continue;const o=r.slice(6).trim();if(o==="[DONE]"){U=!0;break}try{const d=(L=(I=(A=JSON.parse(o).choices)==null?void 0:A[0])==null?void 0:I.delta)==null?void 0:L.content;d&&(C+=d,b(c=>{const j=c[c.length-1];return(j==null?void 0:j.role)==="assistant"&&c.length>1?c.map((O,W)=>W===c.length-1?{...O,content:C}:O):[...c,{role:"assistant",content:C}]}))}catch{n=r+`
`+n;break}}}if(n.trim())for(const i of n.split(`
`)){if(!i||i.startsWith(":")||!i.startsWith("data: "))continue;const a=i.slice(6).trim();if(a!=="[DONE]")try{const r=(B=(E=(S=JSON.parse(a).choices)==null?void 0:S[0])==null?void 0:E.delta)==null?void 0:B.content;r&&(C+=r,b(o=>{const g=o[o.length-1];return(g==null?void 0:g.role)==="assistant"?o.map((d,c)=>c===o.length-1?{...d,content:C}:d):[...o,{role:"assistant",content:C}]}))}catch{}}}catch(s){throw console.error("Chat error:",s),z({title:"Erro",description:s instanceof Error?s.message:"Erro ao processar mensagem",variant:"destructive"}),s}},G=async()=>{if(!h.trim()||u)return;const t={role:"user",content:h.trim()},l=[...w,t];b(l),D(""),y(!0);try{await M(l)}catch{}finally{y(!1)}},T=t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),G())};return J?e.jsxs($,{className:"fixed bottom-6 right-6 w-96 h-[600px] shadow-2xl z-50 flex flex-col",children:[e.jsxs(Z,{className:"flex flex-row items-center justify-between space-y-0 pb-4 bg-primary text-primary-foreground rounded-t-lg",children:[e.jsxs("div",{"trae-inspector-start-line":"195","trae-inspector-start-column":"8","trae-inspector-end-line":"198","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center space-x-2",children:[e.jsx(f,{className:"h-5 w-5"}),e.jsx(_,{className:"text-lg",children:"Gael - Consultora IA"})]}),e.jsx(v,{variant:"ghost",size:"icon",onClick:()=>N(!1),className:"h-8 w-8 text-primary-foreground hover:bg-primary-foreground/20",children:e.jsx(K,{className:"h-4 w-4"})})]}),e.jsxs(Y,{className:"flex-1 flex flex-col p-0",children:[e.jsx(H,{ref:x,className:"flex-1 p-4",children:e.jsxs("div",{"trae-inspector-start-line":"211","trae-inspector-start-column":"10","trae-inspector-end-line":"244","trae-inspector-end-column":"16","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-4",children:[w.map((t,l)=>e.jsx("div",{"trae-inspector-start-line":"213","trae-inspector-start-column":"14","trae-inspector-end-line":"232","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{"trae-inspector-start-line":"217","trae-inspector-start-column":"16","trae-inspector-end-line":"231","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:`max-w-[80%] rounded-lg p-3 ${t.role==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[t.role==="assistant"&&l===0&&e.jsxs("div",{"trae-inspector-start-line":"225","trae-inspector-start-column":"20","trae-inspector-end-line":"228","trae-inspector-end-column":"26","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-2 mb-2",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx("span",{"trae-inspector-start-line":"227","trae-inspector-start-column":"22","trae-inspector-end-line":"227","trae-inspector-end-column":"73","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Gael%22%2C%22textStartLine%22%3A%22227%22%2C%22textStartColumn%22%3A%2262%22%2C%22textEndLine%22%3A%22227%22%2C%22textEndColumn%22%3A%2266%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"font-semibold text-sm",children:"Gael"})]}),e.jsx("p",{"trae-inspector-start-line":"230","trae-inspector-start-column":"18","trae-inspector-end-line":"230","trae-inspector-end-column":"82","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm whitespace-pre-wrap",children:t.content})]})},l)),u&&e.jsx("div",{"trae-inspector-start-line":"235","trae-inspector-start-column":"14","trae-inspector-end-line":"242","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex justify-start",children:e.jsx("div",{"trae-inspector-start-line":"236","trae-inspector-start-column":"16","trae-inspector-end-line":"241","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"bg-muted rounded-lg p-3 max-w-[80%]",children:e.jsxs("div",{"trae-inspector-start-line":"237","trae-inspector-start-column":"18","trae-inspector-end-line":"240","trae-inspector-end-column":"24","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-2",children:[e.jsx(f,{className:"h-4 w-4 animate-pulse"}),e.jsx("span",{"trae-inspector-start-line":"239","trae-inspector-start-column":"20","trae-inspector-end-line":"239","trae-inspector-end-column":"74","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Gael%20est%C3%A1%20pensando...%22%2C%22textStartLine%22%3A%22239%22%2C%22textStartColumn%22%3A%2246%22%2C%22textEndLine%22%3A%22239%22%2C%22textEndColumn%22%3A%2267%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm",children:"Gael está pensando..."})]})})})]})}),e.jsxs("div",{"trae-inspector-start-line":"247","trae-inspector-start-column":"8","trae-inspector-end-line":"268","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"p-4 border-t",children:[e.jsxs("div",{"trae-inspector-start-line":"248","trae-inspector-start-column":"10","trae-inspector-end-line":"264","trae-inspector-end-column":"16","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex gap-2",children:[e.jsx(V,{value:h,onChange:t=>D(t.target.value),onKeyPress:T,placeholder:"Pergunte sobre estratégia, operações, finanças...",disabled:u,className:"flex-1"}),e.jsx(v,{onClick:G,disabled:u||!h.trim(),size:"icon",children:e.jsx(q,{className:"h-4 w-4"})})]}),e.jsx("p",{"trae-inspector-start-line":"265","trae-inspector-start-column":"10","trae-inspector-end-line":"267","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\components\\\\GaelChatbot.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Pressione%20Enter%20para%20enviar%22%2C%22textStartLine%22%3A%22265%22%2C%22textStartColumn%22%3A%2272%22%2C%22textEndLine%22%3A%22267%22%2C%22textEndColumn%22%3A%2210%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-xs text-muted-foreground mt-2 text-center",children:"Pressione Enter para enviar"})]})]})]}):e.jsx(v,{onClick:()=>N(!0),className:"fixed bottom-6 right-6 h-14 w-14 rounded-full shadow-lg bg-primary hover:bg-primary/90 z-50",size:"icon",children:e.jsx(f,{className:"h-6 w-6"})})};export{ae as G};
