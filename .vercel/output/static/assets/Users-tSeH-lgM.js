import{a as M,r as n,j as e,B as C,s as S,d as T,L as I,U as G}from"./index-C8gJK6VO.js";import{I as U}from"./input-D5Ccm-s1.js";import{C as B,d as _}from"./card-XpOOVLWI.js";import{B as P}from"./badge-CRfFogl7.js";import{S as x}from"./StatCard-CvR0DIEf.js";import{u as V,a as O,F as k,b as f,c as j,d as w,e as v,f as b,o as z,_ as R,s as N}from"./form-Req0DYV7.js";import{D as q,a as H,b as J,c as $,e as K}from"./dialog-KfbCdWZy.js";import{S as Q,a as W,b as X,c as Y,d as Z}from"./select-CgN7rKuh.js";import{L as ee}from"./loader-circle-BUprINBZ.js";import{P as se}from"./plus-C4B_3Olf.js";import{U as A}from"./user-Cs2hIgFr.js";import{S as te}from"./search-Da-3pudI.js";import{S as re}from"./square-pen-C6yFawho.js";import{T as ae}from"./trash-2-DqbN6Ybf.js";import"./label-C3geKGxC.js";import"./index-C9UnwKLR.js";import"./Combination-BQvqHitJ.js";import"./index-XPvY48Nz.js";import"./chevron-down-ChCbnXTB.js";import"./check-CMTAF2ib.js";const ie=z({fullName:N().min(3,"Nome deve ter no mínimo 3 caracteres"),email:N().email("Email inválido"),password:N().min(6,"Senha deve ter no mínimo 6 caracteres"),role:R(["admin","driver","finance","operations","commercial","fleet_maintenance","maintenance_assistant","logistics_manager","maintenance_manager"])}),ne={admin:"Administrador",driver:"Motorista",finance:"Financeiro",operations:"Operações",commercial:"Comercial",fleet_maintenance:"Manutenção de Frota",maintenance_assistant:"Auxiliar de Manutenção",logistics_manager:"Gerente de Logística",maintenance_manager:"Gerente de Manutenção"};function oe({open:o,onOpenChange:c,onSuccess:l}){const{signUp:d}=M(),[m,u]=n.useState(!1),a=V({resolver:O(ie),defaultValues:{fullName:"",email:"",password:"",role:"driver"}}),g=async t=>{u(!0);try{await d(t.email,t.password,t.fullName,t.role),a.reset(),c(!1),l==null||l()}catch(i){console.error(i)}finally{u(!1)}};return e.jsx(q,{open:o,onOpenChange:c,children:e.jsxs(H,{className:"sm:max-w-[500px]",children:[e.jsxs(J,{children:[e.jsx($,{children:"Adicionar Novo Usuário"}),e.jsx(K,{children:"Preencha os dados do novo usuário do sistema"})]}),e.jsx(k,{...a,children:e.jsxs("form",{"trae-inspector-start-line":"108","trae-inspector-start-column":"10","trae-inspector-end-line":"190","trae-inspector-end-column":"17","trae-inspector-file-path":"src\\\\components\\\\UserFormDialog.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",onSubmit:a.handleSubmit(g),className:"space-y-4",children:[e.jsx(f,{control:a.control,name:"fullName",render:({field:t})=>e.jsxs(j,{children:[e.jsx(w,{children:"Nome Completo"}),e.jsx(v,{children:e.jsx(U,{placeholder:"João Silva",...t})}),e.jsx(b,{})]})}),e.jsx(f,{control:a.control,name:"email",render:({field:t})=>e.jsxs(j,{children:[e.jsx(w,{children:"Email"}),e.jsx(v,{children:e.jsx(U,{type:"email",placeholder:"joao@optilog.com",...t})}),e.jsx(b,{})]})}),e.jsx(f,{control:a.control,name:"password",render:({field:t})=>e.jsxs(j,{children:[e.jsx(w,{children:"Senha"}),e.jsx(v,{children:e.jsx(U,{type:"password",placeholder:"••••••••",...t})}),e.jsx(b,{})]})}),e.jsx(f,{control:a.control,name:"role",render:({field:t})=>e.jsxs(j,{children:[e.jsx(w,{children:"Perfil de Acesso"}),e.jsxs(Q,{onValueChange:t.onChange,defaultValue:t.value,children:[e.jsx(v,{children:e.jsx(W,{children:e.jsx(X,{placeholder:"Selecione o perfil"})})}),e.jsx(Y,{children:Object.entries(ne).map(([i,D])=>e.jsx(Z,{value:i,children:D},i))})]}),e.jsx(b,{})]})}),e.jsxs("div",{"trae-inspector-start-line":"176","trae-inspector-start-column":"12","trae-inspector-end-line":"189","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\UserFormDialog.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex justify-end gap-3 pt-4",children:[e.jsx(C,{type:"button",variant:"outline",onClick:()=>c(!1),disabled:m,children:"Cancelar"}),e.jsxs(C,{type:"submit",disabled:m,children:[m&&e.jsx(ee,{className:"mr-2 h-4 w-4 animate-spin"}),"Cadastrar"]})]})]})})]})})}const Se=()=>{const[o,c]=n.useState(""),[l,d]=n.useState(!1),[m,u]=n.useState([]),[a,g]=n.useState(!0);n.useEffect(()=>{t()},[]);const t=async()=>{try{g(!0);const{data:s,error:p}=await S.from("profiles").select("*");if(p)throw p;const y=s.map(r=>r.id),{data:E,error:L}=await S.from("user_roles").select("user_id, role").in("user_id",y);if(L)throw L;const h=new Map;E.forEach(r=>{h.has(r.user_id)||h.set(r.user_id,[]),h.get(r.user_id).push(r.role)});const F=s.map(r=>({id:r.id,full_name:r.full_name||r.email,nome:r.full_name||r.email,email:r.email,roles:h.get(r.id)||[],status:"ativo"}));u(F)}catch(s){console.error("Erro ao carregar usuários:",s),T.error("Erro ao carregar usuários")}finally{g(!1)}},i=m.filter(s=>(s.nome||s.full_name||"").toLowerCase().includes(o.toLowerCase())||s.email.toLowerCase().includes(o.toLowerCase())),D=s=>s.map(p=>e.jsx(P,{className:"bg-blue-500/20 text-blue-600 mr-1",children:p},p));return e.jsx(I,{children:e.jsxs("div",{"trae-inspector-start-line":"89","trae-inspector-start-column":"6","trae-inspector-end-line":"162","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-6",children:[e.jsxs("div",{"trae-inspector-start-line":"90","trae-inspector-start-column":"8","trae-inspector-end-line":"96","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-between",children:[e.jsx("h1",{"trae-inspector-start-line":"91","trae-inspector-start-column":"10","trae-inspector-end-line":"91","trae-inspector-end-column":"68","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Gest%C3%A3o%20de%20Usu%C3%A1rios%22%2C%22textStartLine%22%3A%2291%22%2C%22textStartColumn%22%3A%2245%22%2C%22textEndLine%22%3A%2291%22%2C%22textEndColumn%22%3A%2263%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-3xl font-bold",children:"Gestão de Usuários"}),e.jsxs(C,{className:"gap-2",onClick:()=>d(!0),children:[e.jsx(se,{className:"w-4 h-4"}),"Adicionar Usuário"]})]}),e.jsx(oe,{open:l,onOpenChange:d,onSuccess:()=>{}}),e.jsxs("div",{"trae-inspector-start-line":"107","trae-inspector-start-column":"8","trae-inspector-end-line":"112","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx(x,{title:"Total de Usuários",value:"48",icon:G}),e.jsx(x,{title:"Motoristas",value:"28",icon:A}),e.jsx(x,{title:"Mecânicos",value:"12",icon:A}),e.jsx(x,{title:"Gestores",value:"8",icon:A})]}),e.jsx(B,{children:e.jsx(_,{className:"p-4",children:e.jsxs("div",{"trae-inspector-start-line":"117","trae-inspector-start-column":"12","trae-inspector-end-line":"125","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(U,{placeholder:"Buscar por nome ou email...",className:"pl-10",value:o,onChange:s=>c(s.target.value)})]})})}),e.jsx("div",{"trae-inspector-start-line":"130","trae-inspector-start-column":"8","trae-inspector-end-line":"161","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid gap-4",children:a?e.jsx("div",{"trae-inspector-start-line":"132","trae-inspector-start-column":"12","trae-inspector-end-line":"132","trae-inspector-end-column":"45","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Carregando%20usu%C3%A1rios...%22%2C%22textStartLine%22%3A%22132%22%2C%22textStartColumn%22%3A%2217%22%2C%22textEndLine%22%3A%22132%22%2C%22textEndColumn%22%3A%2239%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:"Carregando usuários..."}):i.map(s=>e.jsx(B,{children:e.jsx(_,{className:"p-6",children:e.jsxs("div",{"trae-inspector-start-line":"136","trae-inspector-start-column":"16","trae-inspector-end-line":"157","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-between",children:[e.jsxs("div",{"trae-inspector-start-line":"137","trae-inspector-start-column":"18","trae-inspector-end-line":"148","trae-inspector-end-column":"24","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-4 flex-1",children:[e.jsx("div",{"trae-inspector-start-line":"138","trae-inspector-start-column":"20","trae-inspector-end-line":"140","trae-inspector-end-column":"26","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"w-12 h-12 rounded-full bg-primary/20 flex items-center justify-center",children:e.jsx(A,{className:"w-6 h-6 text-primary"})}),e.jsxs("div",{"trae-inspector-start-line":"141","trae-inspector-start-column":"20","trae-inspector-end-line":"147","trae-inspector-end-column":"26","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex-1",children:[e.jsxs("div",{"trae-inspector-start-line":"142","trae-inspector-start-column":"22","trae-inspector-end-line":"145","trae-inspector-end-column":"28","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-3",children:[e.jsx("h3",{"trae-inspector-start-line":"143","trae-inspector-start-column":"24","trae-inspector-end-line":"143","trae-inspector-end-column":"96","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-lg font-semibold",children:s.full_name||s.nome}),D(s.roles)]}),e.jsx("p",{"trae-inspector-start-line":"146","trae-inspector-start-column":"22","trae-inspector-end-line":"146","trae-inspector-end-column":"88","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground mt-1",children:s.email})]})]}),e.jsxs("div",{"trae-inspector-start-line":"149","trae-inspector-start-column":"18","trae-inspector-end-line":"156","trae-inspector-end-column":"24","trae-inspector-file-path":"src\\\\pages\\\\Users.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex gap-2",children:[e.jsx(C,{variant:"ghost",size:"icon",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx(C,{variant:"ghost",size:"icon",className:"text-destructive hover:text-destructive",children:e.jsx(ae,{className:"w-4 h-4"})})]})]})})},s.id))})]})})};export{Se as default};
