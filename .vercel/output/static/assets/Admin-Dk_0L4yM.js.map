{"version":3,"file":"Admin-Dk_0L4yM.js","sources":["../../src/pages/Admin.tsx"],"sourcesContent":["import { Layout } from '@/components/Layout';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { useEffect, useState } from 'react';\nimport { demoList, demoCreate, demoDelete } from '@/lib/demoStore';\n\nconst tables = ['trips','service_orders','refuelings','vehicles','cte','gate_events','finance_ledgers','non_conformities'];\n\nexport default function Admin() {\n  const [table, setTable] = useState('trips');\n  const [rows, setRows] = useState<any[]>([]);\n  const [form, setForm] = useState<any>({});\n  const [loading, setLoading] = useState(false);\n  const [message, setMessage] = useState('');\n\n  const api = async (op: string, t: string, data?: any) => {\n    const r = await fetch('/api/db', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ op, table: t, data }) });\n    const s = await r.text();\n    try { return { ok: r.ok, data: JSON.parse(s) }; } catch { return { ok: r.ok, data: { raw: s } }; }\n  };\n\n  const load = async () => {\n    setLoading(true); setMessage('');\n    const res = await api('list', table);\n    const arr = Array.isArray(res.data) ? res.data : demoList(table);\n    setRows(arr);\n    setLoading(false);\n  };\n\n  useEffect(() => { load(); }, [table]);\n\n  const importDemo = async () => {\n    setLoading(true); setMessage('');\n    try {\n      const r = await fetch('/api/seed-demo');\n      const js = await r.json();\n      const demo = js.demo || {};\n      for (const t of Object.keys(demo)) {\n        const arr = Array.isArray(demo[t]) ? demo[t] : [];\n        for (const row of arr) demoCreate(t, row);\n      }\n      setMessage('Demo importado localmente');\n      load();\n    } catch (e) {\n      setMessage('Falha ao importar demo');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const submit = async () => {\n    setLoading(true); setMessage('');\n    const res = await api('create', table, form);\n    if (res.ok) { setMessage('Criado'); setForm({}); load(); } else { demoCreate(table, form); setMessage('Criado localmente'); setForm({}); load(); }\n    setLoading(false);\n  };\n\n  const del = async (id: any) => {\n    setLoading(true); setMessage('');\n    const r = await fetch('/api/db', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ op: 'delete', table, id }) });\n    if (!r.ok) demoDelete(table, id);\n    setLoading(false); load();\n  };\n\n  return (\n    <Layout>\n      <div className=\"space-y-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h1 className=\"text-3xl font-bold\">Admin Dados</h1>\n            <p className=\"text-muted-foreground\">CRUD rápido integrado ao Supabase</p>\n          </div>\n          <div className=\"flex gap-2\">\n            <select className=\"border rounded px-3 py-2\" value={table} onChange={(e)=>setTable(e.target.value)}>\n              {tables.map(t => (<option key={t} value={t}>{t}</option>))}\n            </select>\n            <Button onClick={load} disabled={loading}>Atualizar</Button>\n            <Button variant=\"outline\" onClick={importDemo} disabled={loading}>Importar demo</Button>\n          </div>\n        </div>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Criar</CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-3\">\n              {Object.keys(form).length === 0 && (\n                <Input placeholder=\"campo:valor\" value=\"\" onChange={()=>{}} />\n              )}\n              <Input placeholder=\"campo\" value={form.field||''} onChange={(e)=>setForm({ ...form, field: e.target.value })} />\n              <Input placeholder=\"valor\" value={form.value||''} onChange={(e)=>setForm({ ...form, value: e.target.value })} />\n            </div>\n            <Button onClick={submit} disabled={loading}>Criar</Button>\n            {message && <div className=\"text-sm text-muted-foreground\">{message}</div>}\n          </CardContent>\n        </Card>\n\n        <Card>\n          <CardHeader>\n            <CardTitle>Registros</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <div className=\"overflow-auto\">\n              <table className=\"min-w-full text-sm\">\n                <thead>\n                  <tr>\n                    <th className=\"text-left p-2\">id</th>\n                    <th className=\"text-left p-2\">dados</th>\n                    <th className=\"text-left p-2\">ações</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {rows.map((r: any) => (\n                    <tr key={r.id || JSON.stringify(r)} className=\"border-t\">\n                      <td className=\"p-2\">{r.id || '-'}</td>\n                      <td className=\"p-2\"><pre className=\"whitespace-pre-wrap\">{JSON.stringify(r, null, 2)}</pre></td>\n                      <td className=\"p-2\"><Button variant=\"outline\" onClick={()=>del(r.id)} disabled={!r.id}>Excluir</Button></td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </Layout>\n  );\n}\n"],"names":["tables","Admin","table","setTable","useState","rows","setRows","form","setForm","loading","setLoading","message","setMessage","api","op","t","data","r","fetch","method","headers","body","JSON","stringify","s","text","ok","parse","raw","load","res","arr","Array","isArray","demoList","useEffect","importDemo","demo","json","Object","keys","row","demoCreate","submit","del","id","demoDelete","Layout","jsxs","jsx","e","target","value","map","Button","Card","CardHeader","CardTitle","CardContent","length","Input","field"],"mappings":"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"}