import{r as m,j as e,B as R,d as v}from"./index-C8gJK6VO.js";import{C as b,a as j,b as D,d as A}from"./card-XpOOVLWI.js";import{I as l}from"./input-D5Ccm-s1.js";import{L as u}from"./label-C3geKGxC.js";import{u as z}from"./useTomTom-BR81LqCR.js";import{L as p}from"./leaflet-D91Ma3Ee.js";import{M as N}from"./map-pin-BVXVU51t.js";import{P}from"./plus-C4B_3Olf.js";import{T as S}from"./trash-2-DqbN6Ybf.js";import{N as F}from"./navigation-iGwyqmKK.js";import{T as $}from"./trending-up-DWFUeL7W.js";import{C as H}from"./clock-Cc7nNxD7.js";function V({points:h,routeGeometry:C}){const t=m.useRef(null),d=m.useRef(null),{getTileUrl:i}=z();return m.useEffect(()=>{if(!d.current)return;t.current||(t.current=p.map(d.current).setView([-23.5505,-46.6333],13),p.tileLayer(i(),{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:18}).addTo(t.current)),t.current.eachLayer(r=>{var c;(r instanceof p.Marker||r instanceof p.Polyline)&&((c=t.current)==null||c.removeLayer(r))});const g=p.latLngBounds([]);if(h.forEach(r=>{const c=p.divIcon({className:"custom-marker",html:`
          <div class="flex flex-col items-center">
            <div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-bold shadow-lg ${r.type==="origin"?"bg-green-500":r.type==="client"?"bg-blue-500":"bg-red-500"}">
              ${r.type==="origin"?"I":r.type==="client"?"C":"E"}
            </div>
            <div class="bg-white px-2 py-1 rounded shadow-md text-xs font-semibold mt-1 whitespace-nowrap">
              ${r.label}
            </div>
          </div>
        `,iconSize:[40,60],iconAnchor:[20,60]});p.marker([r.lat,r.lng],{icon:c}).addTo(t.current),g.extend([r.lat,r.lng])}),C&&C.length>0){const r=C.map(c=>p.latLng(c[1],c[0]));p.polyline(r,{color:"#3b82f6",weight:4,opacity:.7}).addTo(t.current)}return h.length>0&&t.current.fitBounds(g,{padding:[50,50]}),()=>{t.current&&(t.current.remove(),t.current=null)}},[h,C]),e.jsx("div",{"trae-inspector-start-line":"96","trae-inspector-start-column":"4","trae-inspector-end-line":"99","trae-inspector-end-column":"6","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteMap.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",ref:d,className:"w-full h-[600px] rounded-lg shadow-lg border"})}function re(){const{calculateRoute:h,loading:C}=z(),[t,d]=m.useState({lat:"",lng:"",label:"Início"}),[i,g]=m.useState({lat:"",lng:"",label:"Cliente"}),[r,c]=m.useState([{lat:"",lng:"",label:"Entrega 1"}]),[B,O]=m.useState([]),[U,E]=m.useState([]),[w,T]=m.useState(null),k=()=>{c([...r,{lat:"",lng:"",label:`Entrega ${r.length+1}`}])},I=s=>{c(r.filter((a,n)=>n!==s))},y=(s,a,n)=>{const x=[...r];x[s][a]=n,c(x)},M=async()=>{if(!t.lat||!t.lng){v.error("Preencha a origem da rota");return}if(!i.lat||!i.lng){v.error("Preencha o endereço do cliente");return}const s=r.filter(a=>a.lat&&a.lng);if(s.length===0){v.error("Adicione pelo menos uma entrega");return}try{const a=[{...t,lat:parseFloat(t.lat),lng:parseFloat(t.lng),type:"origin"},{...i,lat:parseFloat(i.lat),lng:parseFloat(i.lng),type:"client"},...s.map(o=>({lat:parseFloat(o.lat),lng:parseFloat(o.lng),label:o.label,type:"delivery"}))];O(a);let n=0,x=0;const L=[];for(let o=0;o<a.length-1;o++){const f=await h({lat:a[o].lat,lng:a[o].lng},{lat:a[o+1].lat,lng:a[o+1].lng},"truck");f&&(n+=f.distance,x+=f.duration,L.push(...f.geometry.coordinates))}E(L),T({distance:n,duration:x}),v.success("Rota calculada com sucesso!")}catch(a){console.error("Erro ao calcular rota:",a),v.error("Erro ao calcular rota")}};return e.jsxs("div",{"trae-inspector-start-line":"117","trae-inspector-start-column":"4","trae-inspector-end-line":"296","trae-inspector-end-column":"10","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{"trae-inspector-start-line":"119","trae-inspector-start-column":"6","trae-inspector-end-line":"290","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-4",children:[e.jsxs(b,{children:[e.jsx(j,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Início da Rota"]})}),e.jsxs(A,{className:"space-y-3",children:[e.jsxs("div",{"trae-inspector-start-line":"128","trae-inspector-start-column":"12","trae-inspector-end-line":"135","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(u,{children:"Nome"}),e.jsx(l,{value:t.label,onChange:s=>d({...t,label:s.target.value}),placeholder:"Ex: Garagem Central"})]}),e.jsxs("div",{"trae-inspector-start-line":"136","trae-inspector-start-column":"12","trae-inspector-end-line":"157","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{"trae-inspector-start-line":"137","trae-inspector-start-column":"14","trae-inspector-end-line":"146","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(u,{children:"Latitude"}),e.jsx(l,{type:"number",step:"any",value:t.lat,onChange:s=>d({...t,lat:s.target.value}),placeholder:"-23.5505"})]}),e.jsxs("div",{"trae-inspector-start-line":"147","trae-inspector-start-column":"14","trae-inspector-end-line":"156","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(u,{children:"Longitude"}),e.jsx(l,{type:"number",step:"any",value:t.lng,onChange:s=>d({...t,lng:s.target.value}),placeholder:"-46.6333"})]})]})]})]}),e.jsxs(b,{children:[e.jsx(j,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5 text-blue-500"}),"Cliente"]})}),e.jsxs(A,{className:"space-y-3",children:[e.jsxs("div",{"trae-inspector-start-line":"169","trae-inspector-start-column":"12","trae-inspector-end-line":"176","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(u,{children:"Nome"}),e.jsx(l,{value:i.label,onChange:s=>g({...i,label:s.target.value}),placeholder:"Ex: Cliente ABC"})]}),e.jsxs("div",{"trae-inspector-start-line":"177","trae-inspector-start-column":"12","trae-inspector-end-line":"198","trae-inspector-end-column":"18","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{"trae-inspector-start-line":"178","trae-inspector-start-column":"14","trae-inspector-end-line":"187","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(u,{children:"Latitude"}),e.jsx(l,{type:"number",step:"any",value:i.lat,onChange:s=>g({...i,lat:s.target.value}),placeholder:"-23.5505"})]}),e.jsxs("div",{"trae-inspector-start-line":"188","trae-inspector-start-column":"14","trae-inspector-end-line":"197","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[e.jsx(u,{children:"Longitude"}),e.jsx(l,{type:"number",step:"any",value:i.lng,onChange:s=>g({...i,lng:s.target.value}),placeholder:"-46.6333"})]})]})]})]}),e.jsxs(b,{children:[e.jsx(j,{children:e.jsxs(D,{className:"flex items-center justify-between",children:[e.jsxs("span",{"trae-inspector-start-line":"205","trae-inspector-start-column":"14","trae-inspector-end-line":"208","trae-inspector-end-column":"21","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5 text-red-500"}),"Entregas"]}),e.jsx(R,{size:"sm",onClick:k,children:e.jsx(P,{className:"h-4 w-4"})})]})}),e.jsx(A,{className:"space-y-4",children:r.map((s,a)=>e.jsxs("div",{"trae-inspector-start-line":"216","trae-inspector-start-column":"14","trae-inspector-end-line":"250","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-3 pb-4 border-b last:border-b-0",children:[e.jsxs("div",{"trae-inspector-start-line":"217","trae-inspector-start-column":"16","trae-inspector-end-line":"228","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-between",children:[e.jsxs(u,{children:["Entrega ",a+1]}),r.length>1&&e.jsx(R,{size:"sm",variant:"ghost",onClick:()=>I(a),children:e.jsx(S,{className:"h-4 w-4"})})]}),e.jsx(l,{value:s.label,onChange:n=>y(a,"label",n.target.value),placeholder:`Nome da entrega ${a+1}`}),e.jsxs("div",{"trae-inspector-start-line":"234","trae-inspector-start-column":"16","trae-inspector-end-line":"249","trae-inspector-end-column":"22","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-2 gap-2",children:[e.jsx(l,{type:"number",step:"any",value:s.lat,onChange:n=>y(a,"lat",n.target.value),placeholder:"Latitude"}),e.jsx(l,{type:"number",step:"any",value:s.lng,onChange:n=>y(a,"lng",n.target.value),placeholder:"Longitude"})]})]},a))})]}),e.jsxs(R,{className:"w-full",size:"lg",onClick:M,disabled:C,children:[e.jsx(F,{className:"h-5 w-5 mr-2"}),C?"Calculando...":"Calcular Rota Otimizada"]}),w&&e.jsxs(b,{children:[e.jsx(j,{children:e.jsx(D,{children:"Informações da Rota"})}),e.jsxs(A,{className:"space-y-2",children:[e.jsxs("div",{"trae-inspector-start-line":"271","trae-inspector-start-column":"14","trae-inspector-end-line":"277","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-between",children:[e.jsxs("span",{"trae-inspector-start-line":"272","trae-inspector-start-column":"16","trae-inspector-end-line":"275","trae-inspector-end-column":"23","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx($,{className:"h-4 w-4"}),"Distância Total"]}),e.jsxs("span",{"trae-inspector-start-line":"276","trae-inspector-start-column":"16","trae-inspector-end-line":"276","trae-inspector-end-column":"94","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"font-bold",children:[(w.distance/1e3).toFixed(2)," km"]})]}),e.jsxs("div",{"trae-inspector-start-line":"278","trae-inspector-start-column":"14","trae-inspector-end-line":"286","trae-inspector-end-column":"20","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center justify-between",children:[e.jsxs("span",{"trae-inspector-start-line":"279","trae-inspector-start-column":"16","trae-inspector-end-line":"282","trae-inspector-end-column":"23","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(H,{className:"h-4 w-4"}),"Tempo Estimado"]}),e.jsxs("span",{"trae-inspector-start-line":"283","trae-inspector-start-column":"16","trae-inspector-end-line":"285","trae-inspector-end-column":"23","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"font-bold",children:[Math.floor(w.duration/60),"h ",Math.floor(w.duration%60),"min"]})]})]})]})]}),e.jsx("div",{"trae-inspector-start-line":"293","trae-inspector-start-column":"6","trae-inspector-end-line":"295","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\components\\\\tms\\\\RouteOptimizer.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"lg:col-span-2",children:e.jsx(V,{points:B,routeGeometry:U})})]})}export{re as R};
