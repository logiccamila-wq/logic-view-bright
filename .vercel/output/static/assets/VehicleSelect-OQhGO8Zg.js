import{r as h,s as f,j as p,$ as S}from"./index-C8gJK6VO.js";import{S as x,a as V,b as j,c as E,d as y}from"./select-CgN7rKuh.js";import{d as C}from"./demoStore-BIsfGJR8.js";function g(e){const n=(e==null?void 0:e.placa)||(e==null?void 0:e.plate)||"",c=(e==null?void 0:e.modelo)||(e==null?void 0:e.model)||"",r=(e==null?void 0:e.tipo)||(e==null?void 0:e.type)||"",m=(e==null?void 0:e.status)||"",l=(e==null?void 0:e.km)||(e==null?void 0:e.mileage)||(e==null?void 0:e.odometer)||void 0;return{plate:n,model:c,type:r,status:m,mileage:l}}function b(){const[e,n]=h.useState([]),[c,r]=h.useState(!0),[m,l]=h.useState(""),d=async()=>{r(!0),l("");try{const{data:a,error:s}=await f.from("vehicles").select("*");if(s)throw s;let t=(a||[]).map(g).filter(o=>!!o.plate);if(t=[...new Map(t.map(o=>[o.plate,o])).values()],t.sort((o,i)=>o.plate.localeCompare(i.plate)),t.length===0){const i=(C("vehicles")||[]).map(g).filter(A=>!!A.plate);i.length>0?t=i:t=[{plate:"ABC-1234",model:"Volvo FH 540",type:"Caminhão",status:"Ativo"},{plate:"DEF-5678",model:"Scania R450",type:"Caminhão",status:"Ativo"},{plate:"GHI-9012",model:"Mercedes-Benz Actros",type:"Caminhão",status:"Manutenção"},{plate:"JKL-3456",model:"DAF XF",type:"Caminhão",status:"Ativo"},{plate:"MNO-7890",model:"Volkswagen Meteor",type:"Caminhão",status:"Ativo"},{plate:"PQR-1234",model:"Iveco S-Way",type:"Caminhão",status:"Ativo"},{plate:"EJG-1234",model:"Demo Truck",type:"Caminhão",status:"Ativo"}]}n(t)}catch(a){const t=(C("vehicles")||[]).map(g);n(t.length?t:[{plate:"ABC-1234",model:"Volvo FH 540",type:"Caminhão",status:"Ativo"},{plate:"DEF-5678",model:"Scania R450",type:"Caminhão",status:"Ativo"},{plate:"EJG-1234",model:"Demo Truck",type:"Caminhão",status:"Ativo"}]),l((a==null?void 0:a.message)||"Falha ao carregar veículos")}finally{r(!1)}};return h.useEffect(()=>{d();const a=f.channel("vehicles_changes").on("postgres_changes",{event:"*",schema:"public",table:"vehicles"},()=>d()).subscribe();return()=>{f.removeChannel(a)}},[]),{vehicles:e,loading:c,error:m,refresh:d,getByPlate:a=>e.find(s=>s.plate===a)}}function B({value:e,onChange:n,onSelectVehicle:c,className:r,placeholder:m="Selecione uma placa",filter:l,required:d}){const{vehicles:u,loading:a}=b(),s=l?u.filter(l):u;return p.jsxs(x,{value:e||"",onValueChange:t=>{if(n(t),c){const o=u.find(i=>i.plate===t);o&&c(o)}},required:d,children:[p.jsx(V,{className:S("w-full",r),children:p.jsx(j,{placeholder:a?"Carregando...":m})}),p.jsxs(E,{children:[s.map(t=>p.jsxs(y,{value:t.plate,children:[t.plate," ",t.model?`- ${t.model}`:""]},t.plate)),s.length===0&&!a&&p.jsx(y,{value:"_empty",disabled:!0,children:"Nenhum veículo encontrado"})]})]})}export{B as V,b as u};
