import{r as l,j as t,L as G,B as _,s as i,a7 as P,a5 as F,a8 as K}from"./index-C8gJK6VO.js";import{C as w,d as A,a as O,b as $}from"./card-XpOOVLWI.js";function J(){const[b,S]=l.useState([]),[j,d]=l.useState(!1),[m,C]=l.useState(""),u=async()=>{d(!0),C("");try{const s=new Date;s.setMonth(s.getMonth()-12);const{data:a}=await i.from("revenue_records").select("valor_frete, valor_icms, data_emissao").order("data_emissao",{ascending:!1}).limit(2e3),n=(a||[]).filter(e=>new Date(e.data_emissao).getTime()>=s.getTime()).reduce((e,o)=>e+(o.valor_frete||0),0),D=(a||[]).filter(e=>new Date(e.data_emissao).getTime()>=s.getTime()).reduce((e,o)=>e+(o.valor_icms||0),0),{data:g}=await i.from("vehicles").select("id, status"),L=(g||[]).filter(e=>String(e.status||"").toUpperCase().includes("ATIV")).length||(g||[]).length,{data:h}=await i.from("service_orders").select("status, vehicle_plate, odometer, created_at, completed_at, labor_hours"),y=(h||[]).filter(e=>(e.status||"").toLowerCase().includes("abert")||(e.status||"").toLowerCase().includes("pend")).length,{data:B,error:E}=await i.from("non_conformities").select("severity, status").limit(500),N=E?0:(B||[]).filter(e=>(e.status||"").toLowerCase().includes("open")||(e.severity||0)>=7).length,{data:T}=await i.from("trips").select("status").limit(500),M=(T||[]).filter(e=>(e.status||"").toLowerCase().includes("andamento")||(e.status||"").toLowerCase().includes("ativa")).length,{data:I}=await i.from("refuelings").select("cost_per_km, timestamp, vehicle_plate").order("timestamp",{ascending:!1}).limit(2e3),R=P((I||[]).map(e=>({km:0,liters:0,total_value:0,cost_per_km:e.cost_per_km,timestamp:e.timestamp,vehicle_plate:e.vehicle_plate}))).avgCostPerKm,c=new Map;(h||[]).forEach(e=>{c.has(e.vehicle_plate)||c.set(e.vehicle_plate,[]),c.get(e.vehicle_plate).push(e)});let v=0;c.forEach((e,o)=>{const k=Math.max(...e.map(r=>r.odometer||0));F(e.map(r=>({status:r.status,created_at:r.created_at||new Date().toISOString(),completed_at:r.completed_at,vehicle_plate:o,odometer:r.odometer||0,labor_hours:r.labor_hours||0})),k).predictedDays<=30&&(v+=1)});const{data:p}=await i.from("tpms_readings").select("pressure_psi, temperature_celsius, tread_depth_mm, alert_level, created_at, vehicle_plate, tire_position").order("created_at",{ascending:!1}).limit(200),f=p&&p.length>0?K(p):null,x=new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}),U=[{title:"Receita Total (12m)",value:x.format(n||0)},{title:"ICMS Total (12m)",value:x.format(D||0)},{title:"Veículos Ativos",value:L||0},{title:"Ordens Pendentes",value:y||0},{title:"NCs Críticas",value:N||0},{title:"Rotas em Andamento",value:M||0},{title:"Custo/KM Médio",value:R||"--"},{title:"Previsões Manutenção (30d)",value:v||0,detail:f?`Risco pneus: ${f.riskScore}%`:void 0}];S(U)}catch(s){const a=s instanceof Error?s.message:String(s);C(a||"Falha ao carregar insights")}finally{d(!1)}};return l.useEffect(()=>{u()},[]),t.jsx(G,{children:t.jsxs("div",{"trae-inspector-start-line":"127","trae-inspector-start-column":"6","trae-inspector-end-line":"166","trae-inspector-end-column":"12","trae-inspector-file-path":"src\\\\pages\\\\SuperGestor.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"space-y-6",children:[t.jsxs("div",{"trae-inspector-start-line":"128","trae-inspector-start-column":"8","trae-inspector-end-line":"131","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\SuperGestor.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",children:[t.jsx("h1",{"trae-inspector-start-line":"129","trae-inspector-start-column":"10","trae-inspector-end-line":"129","trae-inspector-end-column":"61","trae-inspector-file-path":"src\\\\pages\\\\SuperGestor.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22Supergestor%22%2C%22textStartLine%22%3A%22129%22%2C%22textStartColumn%22%3A%2245%22%2C%22textEndLine%22%3A%22129%22%2C%22textEndColumn%22%3A%2256%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-3xl font-bold",children:"Supergestor"}),t.jsx("p",{"trae-inspector-start-line":"130","trae-inspector-start-column":"10","trae-inspector-end-line":"130","trae-inspector-end-column":"104","trae-inspector-file-path":"src\\\\pages\\\\SuperGestor.tsx","trae-inspector-static-props":"%7B%22text%22%3A%22IA%20integrada%20para%20decis%C3%B5es%20operacionais%20e%20financeiras%22%2C%22textStartLine%22%3A%22130%22%2C%22textStartColumn%22%3A%2247%22%2C%22textEndLine%22%3A%22130%22%2C%22textEndColumn%22%3A%22100%22%2C%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-muted-foreground",children:"IA integrada para decisões operacionais e financeiras"})]}),m&&t.jsx(w,{className:"border-destructive",children:t.jsx(A,{className:"p-4 text-destructive",children:m})}),t.jsx("div",{"trae-inspector-start-line":"139","trae-inspector-start-column":"8","trae-inspector-end-line":"151","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\SuperGestor.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:b.map((s,a)=>t.jsxs(w,{children:[t.jsx(O,{children:t.jsx($,{children:s.title})}),t.jsxs(A,{children:[t.jsx("div",{"trae-inspector-start-line":"146","trae-inspector-start-column":"16","trae-inspector-end-line":"146","trae-inspector-end-column":"67","trae-inspector-file-path":"src\\\\pages\\\\SuperGestor.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-2xl font-bold",children:s.value}),s.detail&&t.jsx("p",{"trae-inspector-start-line":"147","trae-inspector-start-column":"29","trae-inspector-end-line":"147","trae-inspector-end-column":"93","trae-inspector-file-path":"src\\\\pages\\\\SuperGestor.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"text-sm text-muted-foreground mt-1",children:s.detail})]})]},a))}),t.jsxs("div",{"trae-inspector-start-line":"153","trae-inspector-start-column":"8","trae-inspector-end-line":"165","trae-inspector-end-column":"14","trae-inspector-file-path":"src\\\\pages\\\\SuperGestor.tsx","trae-inspector-static-props":"%7B%22cwd%22%3A%22C%3A%5C%5CUsers%5C%5CCamila%20Lareste%5C%5CDocuments%5C%5Clogic-view-bright-main%5C%5Clogic-view-bright-main%22%7D",className:"flex gap-2",children:[t.jsx(_,{onClick:u,disabled:j,children:"Atualizar Insights"}),t.jsx(_,{variant:"outline",onClick:async()=>{var s;try{const n=await(await fetch("/api/predict-maintenance")).json();alert(`Previstos: ${((s=n.predictions)==null?void 0:s.length)||0}`)}catch(a){const n=a instanceof Error?a.message:String(a);alert(`Falha ao rodar preditivo: ${n}`)}},children:"Rodar Preditivo"})]})]})})}export{J as default};
