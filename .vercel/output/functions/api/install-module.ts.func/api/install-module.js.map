{"version":3,"file":"install-module.ts","sources":["C:\\Users\\Camila Lareste\\Documents\\logic-view-bright-main\\logic-view-bright-main\\api\\install-module.ts"],"names":[],"mappings":"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","sourcesContent":["export default async function handler(req: any, res: any) {\n  if (req.method !== \"POST\") return res.status(405).json({ error: \"Method not allowed\" })\n  const supabaseUrl = process.env.SUPABASE_URL || \"\"\n  const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || \"\"\n  if (!supabaseUrl || !serviceKey) return res.status(500).json({ error: \"Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\" })\n\n  let moduleId = \"\"\n  let clientKey = \"\"\n  try {\n    const b = req.body || {}\n    moduleId = (b.moduleId || \"\").trim()\n    clientKey = (b.clientKey || \"\").trim()\n  } catch {}\n  if (!moduleId) return res.status(400).json({ error: \"moduleId required\" })\n\n  const known: Record<string, { name: string; category: string; description?: string; comingSoon?: boolean }> = {\n    dashboard: { name: \"Dashboard OptiLog\", category: \"core\" },\n    tms: { name: \"TMS\", category: \"logistics\" },\n    wms: { name: \"WMS\", category: \"logistics\" },\n    oms: { name: \"OMS\", category: \"operations\" },\n    \"mechanic-hub\": { name: \"Hub Mecânico\", category: \"maintenance\" },\n    \"driver-app\": { name: \"App Motorista\", category: \"mobile\" },\n    \"control-tower\": { name: \"Torre de Controle\", category: \"operations\" },\n    crm: { name: \"CRM\", category: \"business\" },\n    erp: { name: \"ERP\", category: \"business\" },\n    ai: { name: \"Inteligência Artificial\", category: \"advanced\", comingSoon: true },\n    blockchain: { name: \"Blockchain\", category: \"advanced\", comingSoon: true },\n    supergestor: { name: \"Supergestor\", category: \"operations\" },\n    \"predictive-maintenance\": { name: \"Manutenção Preditiva\", category: \"maintenance\" },\n    \"drivers-management\": { name: \"Gestão de Motoristas\", category: \"operations\" },\n    approvals: { name: \"Aprovações\", category: \"operations\" },\n    \"logistics-kpi\": { name: \"KPIs de Logística\", category: \"operations\" },\n    \"bank-reconciliation\": { name: \"Conciliação Bancária\", category: \"finance\" },\n    \"cost-monitoring\": { name: \"Monitoramento de Custos\", category: \"finance\" },\n    iot: { name: \"IoT\", category: \"iot\" },\n    permissions: { name: \"Permissões\", category: \"operations\" },\n    developer: { name: \"Developer\", category: \"dev\" },\n    reports: { name: \"Relatórios\", category: \"business\" }\n  }\n\n  const headers = { \"Content-Type\": \"application/json\", Authorization: `Bearer ${serviceKey}`, apikey: serviceKey }\n  const upsert = async (slug: string) => {\n    const meta = known[slug] || { name: slug, category: \"operations\" }\n    const enabled = !meta.comingSoon\n    const url = `${supabaseUrl}/rest/v1/modules?on_conflict=slug`\n    const r = await fetch(url, {\n      method: \"POST\",\n      headers: { ...headers, Prefer: \"resolution=merge-duplicates\" },\n      body: JSON.stringify({ slug, name: meta.name, category: meta.category, description: meta.description || slug, enabled })\n    })\n    if (!r.ok) throw new Error(await r.text())\n    return r.json().catch(() => ({}))\n  }\n\n  try {\n    const targets = moduleId === \"all\" ? Object.keys(known).filter(k => !known[k]?.comingSoon) : [moduleId]\n    const installed: string[] = []\n    for (const slug of targets) {\n      await upsert(slug)\n      installed.push(slug)\n    }\n    return res.status(200).json({ ok: true, installedCount: installed.length, installed, client: clientKey || null })\n  } catch (e: any) {\n    return res.status(500).json({ error: e.message || \"install_failed\" })\n  }\n}\n\n"]}