{"version":3,"file":"create-user.ts","sources":["C:\\Users\\Camila Lareste\\Documents\\logic-view-bright-main\\logic-view-bright-main\\api\\create-user.ts"],"names":[],"mappings":"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","sourcesContent":["import { createClient } from \"@supabase/supabase-js\";\n\nexport default async function handler(req: any, res: any) {\n  try {\n    if (req.method !== \"POST\") {\n      return res.status(405).json({ error: \"Method not allowed\" });\n    }\n\n    const supabaseUrl = process.env.SUPABASE_URL || \"\";\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || \"\";\n    if (!supabaseUrl || !serviceKey) {\n      return res.status(500).json({ error: \"Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\" });\n    }\n\n    const { email, password, role } = (req.body || {}) as { email?: string; password?: string; role?: string };\n    if (!email || !password) {\n      return res.status(400).json({ error: \"email and password required\" });\n    }\n\n    const supabase = createClient(supabaseUrl, serviceKey);\n\n    const { data: userRes, error: createErr } = await supabase.auth.admin.createUser({\n      email,\n      password,\n      email_confirm: true,\n    });\n    if (createErr) {\n      return res.status(400).json({ error: \"create_user_failed\", detail: createErr.message });\n    }\n\n    const userId = userRes?.user?.id || \"\";\n    if (!userId) {\n      return res.status(500).json({ error: \"user_id_missing\" });\n    }\n\n    let roleResult: any = null;\n    if (role && typeof role === \"string\" && role.trim().length > 0) {\n      const resp = await fetch(`${supabaseUrl}/rest/v1/user_roles`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          Authorization: `Bearer ${serviceKey}`,\n          apikey: serviceKey,\n          Prefer: \"return=representation\",\n        },\n        body: JSON.stringify({ user_id: userId, role }),\n      });\n      const txt = await resp.text();\n      try { roleResult = JSON.parse(txt); } catch { roleResult = { raw: txt }; }\n      if (resp.status !== 201 && resp.status !== 200) {\n        return res.status(resp.status).json({ error: \"assign_role_failed\", detail: roleResult });\n      }\n    }\n\n    return res.status(200).json({ success: true, user_id: userId, email, role, user: userRes?.user, roleResult });\n  } catch (e: any) {\n    return res.status(500).json({ error: \"unexpected_error\", detail: e?.message || String(e) });\n  }\n}\n\n"]}