{"version":3,"file":"permissions-matrix.ts","sources":["C:\\Users\\Camila Lareste\\Documents\\logic-view-bright-main\\logic-view-bright-main\\api\\permissions-matrix.ts"],"names":[],"mappings":"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","sourcesContent":["export default async function handler(req: any, res: any) {\n  if (req.method !== \"GET\") return res.status(405).json({ error: \"Method not allowed\" })\n  const supabaseUrl = process.env.SUPABASE_URL || \"\"\n  const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || \"\"\n  if (!supabaseUrl || !serviceKey) return res.status(500).json({ error: \"Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY\" })\n  const h = { Authorization: `Bearer ${serviceKey}`, apikey: serviceKey }\n  const [modsRes, profRes, permRes] = await Promise.all([\n    fetch(`${supabaseUrl}/rest/v1/modules?select=id,key,name,description`, { headers: h }),\n    fetch(`${supabaseUrl}/rest/v1/profiles?select=id,key,name,description`, { headers: h }),\n    fetch(`${supabaseUrl}/rest/v1/profile_permissions?select=profile_id,module_function_id`, { headers: h })\n  ])\n  if (!modsRes.ok) return res.status(modsRes.status).json({ error: \"modules_fetch_failed\", detail: await modsRes.text() })\n  if (!profRes.ok) return res.status(profRes.status).json({ error: \"profiles_fetch_failed\", detail: await profRes.text() })\n  if (!permRes.ok) return res.status(permRes.status).json({ error: \"permissions_fetch_failed\", detail: await permRes.text() })\n  const modules = await modsRes.json()\n  const profiles = await profRes.json()\n  const perms = await permRes.json()\n  const mfRes = await fetch(`${supabaseUrl}/rest/v1/module_functions?select=id,module_id,key,name`, { headers: h })\n  if (!mfRes.ok) return res.status(mfRes.status).json({ error: \"module_functions_fetch_failed\", detail: await mfRes.text() })\n  const mfs = await mfRes.json()\n  const modById: Record<string, any> = {}\n  for (const m of modules) modById[m.id] = m\n  const profById: Record<string, any> = {}\n  for (const p of profiles) profById[p.id] = p\n  const matrix: Record<string, Record<string, boolean>> = {}\n  for (const pr of perms) {\n    const mf = mfs.find((x: any) => x.id === pr.module_function_id)\n    const mod = mf ? modById[mf.module_id] : null\n    const prof = profById[pr.profile_id]\n    if (!mod || !prof) continue\n    const pk = prof.key\n    const mk = mod.key\n    if (!matrix[mk]) matrix[mk] = {}\n    matrix[mk][pk] = true\n  }\n  res.status(200).json({ modules, profiles, matrix })\n}\n"]}